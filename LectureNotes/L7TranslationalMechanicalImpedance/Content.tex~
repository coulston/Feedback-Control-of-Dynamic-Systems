\usetikzlibrary{patterns}
\usepackage{framed}
\usetikzlibrary{decorations.pathmorphing}
\mode<presentation>
{
  \usetheme{CambridgeUS}
  \usecolortheme{whale}
  \usecolortheme{lily}

  \setbeamercovered{transparent}
  \usefonttheme[onlymath]{serif}
}

\title[Mesh Equations] % (optional, use only with long paper titles)
{EGGN307: Mesh Equations\license}

\subtitle
{} % (optional)

\author% (optional, use only with lots of authors)
{Tyrone Vincent}
%{T. Vincent\inst{1} \and S.~Another\inst{2}}
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[CSM] % (optional, but mostly needed)
{Division of Engineering\\
  Colorado School of Mines}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

\date % (optional)
{Lecture 9}



% If you have a file called "university-logo-filename.xxx", where xxx
% is a graphic format that can be processed by latex or pdflatex,
% resp., then you can add a logo as follows:

%\pgfdeclareimage[height=1.1cm]{university-logo}{UniversityLogo}
%\logo{\pgfuseimage{university-logo}}



% Delete this, if you do not want the table of contents to pop up at
% the beginning of each subsection:
%\AtBeginSection[]
%{
%  \begin{frame}<beamer>{Outline}
%    \tableofcontents[currentsection,currentsubsection]
%  \end{frame}
%}


% If you wish to uncover everything in a step-wise fashion, uncomment
% the following command:

%\beamerdefaultoverlayspecification{<+->}


\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\mode<article>{
\maketitle
\tableofcontents
}

%\mode<presentation>{
%\begin{frame}{Outline}
%  \tableofcontents
%  % You might wish to add the option [pausesections]
%\end{frame}}
\section{Mesh Equations}

Although we can always use our circuit simplification rules (elements in series, elements in parallel, voltage divider, etc.) to find a transfer function, these cannot always be used to solve every circuit. There are two systematic methods for writing down the algebraic equations that describe a system in a matrix/vector format that can always then be solved for the desired input/output relationship. The first method uses mesh equations.

\subsection{Circuit Mesh}

Any time a circuit forms a loop, the fact that voltages are uniquely defined at a node means that the voltages around the node sum to zero (also known as Kirchoff's voltage law). For example, the following is a mesh

\begin{frame}{Mesh example}
\begin{center}
\input{figures/genericmesh.tex}
\end{center}
\end{frame}
As we add the voltages, we have to pay attention to the sign - whether the voltage is an increase or decrease as we go around the mesh. Starting from the low left corner and moving clockwise, we increase by voltage $v_{1}$, then decrease by $v_{2}$ and $v_{3}$. Thus, the mesh equation is
\[
v_{1} - v_{2} - v_{3} = 0.
\]

Impedances and meshes allow us to quickly write down the equations that define a circuit. This is best explained via an example

\section{Examples}

\subsection{Circuit Problem}

\begin{frame}{Circuit problem}
\begin{center}
\input{figures/circuitproblem.tex}
\end{center}
\end{frame}

This circuit has two (unique) meshes. One mesh is the loop containing the applied voltage, resistor and capacitor, while the second mesh is the loop that contains the capacitor and inductor. 

To find the equations describing the circuit behavior, we convert the elements to impedances and define the currents around each mesh. Two equations can be written by summing the voltages around each mesh

\begin{frame}{Circuit problem in impedance form}
\begin{center}
\input{figures/circuitproblemimpedance.tex}
\end{center}
\end{frame}

Now let's isolate each mesh

\begin{frame}{Two meshes}
\begin{center}
\input{figures/circuitproblem2mesh.tex}
\end{center}
\end{frame}
Note that for the capacitor, the connection laws imply that the current through the capacitor is the difference between $I_{1}$ and $I_{2}$. 
Since the voltage drop is always in the same direction as the current, in the left hand mesh, we go up $V_{in}$ volts, and then down $I_{1}(s)R$ and $(I_{1}(s)-I_{2}(s))\frac{1}{sC}$ volts, so that
\[
V_{in}(s) - I_{1}(s)R - (I_{1}(s)-I_{2}(s))\frac{1}{sC} = 0
\]
For the right hand mesh, we go up $(I_{1}(s)-I_{2}(s))\frac{1}{sC}$ and down $I_{s}sL$, so that
\[
(I_{1}(s)-I_{2}(s))\frac{1}{sC} - I_{2}sL = 0
\]

By putting these equations into matrix-vector form, some patterns become obvious that can help us write down the equations more quickly. To do this, first we collect terms that multiply the same current
\begin{align*}
V_{in}(s) - \left(R+\frac{1}{sC}\right)I_{1}(s) + \frac{1}{sC}I_{2}(s) &=0\\
\frac{1}{sC}I_{1}(s) - \left(\frac{1}{sC} + sL\right)I_{2}(s) & =0
\end{align*}
By moving all the current terms to the other side of the equation, the mesh equations have the following form:
\[
\begin{bmatrix} V_{in}(s) \\ 0 \end{bmatrix} = \begin{bmatrix} R + \frac{1}{sC} & -\frac{1}{sC} \\ -\frac{1}{sC} & \frac{1}{sC} + sL \end{bmatrix} \begin{bmatrix} I_{1}(s) \\ I_{2}(s) \end{bmatrix}
\]
\begin{frame}{Patterns of mesh equations}
\begin{itemize}
\item the matrix is symmetric
\item the diagonal terms are positive
\item the off-diagonal terms are negative 
\end{itemize}
\begin{center}
\input{figures/meshequations.tex}
\end{center}
\end{frame}
Since the system output of interest is not one of the mesh currents, we need to augment these equations with an ``output equation'' that relates the mesh currents to the output
\[
V_{out}(s) = sL I_{2}(s)
\]

Now we can find the transfer function from $V_{in}$ to $V_{out}$ by first solving for $I_{2}(s)$ in the mesh equations, and then plugging it into the output equations. For example, using the second mesh, we have
\begin{align*}
I_{1}(s) &= \frac{\left(\frac{1}{sC}+sL\right)}{\frac{1}{sC}}I_{2}(s) \\
& = (1+s^{2}LC)I_{2}(s)
\end{align*}
Plugging into the first mesh equation,
\begin{align*}
V_{in}(s) &= \left(R+\frac{1}{sC}\right)\left(1+s^{2}LC\right)I_{2}(s) - \frac{1}{sC}I_{2}(s)\\
&= \left(R+s^{2}RLC+sL\right)I_{2}
\end{align*}
so that the transfer function from $V_{in}$ to $I_{2}$ is
\[
\frac{I_{2}(s)}{V_{in}(s)} = \frac{1}{s^{2}RLC + sL +R}
\]
Since the output equation gives us
\[
\frac{V_{out}(s)}{I_{2}(s)} = sL
\]
The transfer function from input voltage to output voltage is
\[
\frac{V_{out}(s)}{V_{in}(s)} = \frac{V_{out}(s)}{I_{2}(s)}\frac{I_{2}(s)}{V_{in}(s)} = \frac{sL}{s^{2}RLC + sL +R}
\]
\subsection{Another Circuit}

\begin{frame}{A Circuit with three meshes}\vspace{-.2in}
\begin{center}
\input{figures/circuitproblem3mesh.tex}
\end{center}
\end{frame}
Find the mesh equations for this circuit.\vspace{.1in}\\
\tryit{
\begin{boxedminipage}{6.5 in}
\rule{0pt}{12pt}\vspace{1.5in}
\color{lightgray}
\begin{align*}
\begin{bmatrix} V_{in}(s) \\ 0 \\ 0 \end{bmatrix} &= \begin{bmatrix} 1+\frac{1}{s} & -\frac{1}{s} & 0 \\
-\frac{1}{s} & \frac{1}{s} +5 & -2 \\
0 & -2 & 2+2s \end{bmatrix}\begin{bmatrix} I_{1}(s) \\ I_{2}(s) \\ I_{3}(s) \end{bmatrix}\\
V_{out}(s) &= 2sI_{3}(s)
\end{align*}

\end{boxedminipage}\\
}{\begin{boxedminipage}{6.5in}
\begin{align*}
\begin{bmatrix} V_{in}(s) \\ 0 \\ 0 \end{bmatrix} &= \begin{bmatrix} 1+\frac{1}{s} & -\frac{1}{s} & 0 \\
-\frac{1}{s} & \frac{1}{s} +5 & -2 \\
0 & -2 & 2+2s \end{bmatrix}\begin{bmatrix} I_{1}(s) \\ I_{2}(s) \\ I_{3}(s) \end{bmatrix}\\
V_{out}(s) &= 2sI_{3}(s)
\end{align*}
\end{boxedminipage}
}

\subsection{Fluid Problem}

Impedances can also be extended to other problem domains. Although different definitions are possible, we will be consistent and define impedance to be the ratio of the across variable (such as voltage) to the through variable (such as current). For fluid systems, we have the following impedances
\begin{frame}{Fluid Impedances}
\begin{center}
\resizebox{10cm}{!}{
\begin{tabular}{c|cc}
 & valve & tank \\\hline
Component &\input{figures/valve.tex} & \input{figures/tank.tex} \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Component law & $p=Rq$ & $\frac{A}{\rho g}\frac{dp}{dt} = q_{in} - q_{out}$ \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform & $P(s)= RQ(s)$ & $\frac{A}{\rho g}sP(s) = Q_{in}(s)-Q_{out}(s)$ \\\hline
 Impedance Component & \input{figures/valveanalogy.tex} & \input{figures/tankanalogy.tex}
 \end{tabular}}
\end{center}
\end{frame}

\begin{frame}{Tank example}
Consider the problem of a single tank fed by a input at pressure $p_{in}$. Find the transfer function from $p_{in}$ to $p_{1}$. 
\begin{center}
\input{figures/1tank.tex}
\end{center}
\end{frame}

To find the equations, we can replace each element with the impedance equivalent, along with a ``pressure source''. Since pressure is an across variable, this is like a voltage source.  Note that there are two identifiable pressures - the pressure at the bottom of the tank, $p_{1}$  and the atmospheric pressure $p_{a}$. Our circuit should thus have two identifiable voltage nodes (one of which will be ground)

\begin{frame}{Two tank mesh}
\begin{center}
\input{figures/1tankmesh.tex}
\end{center}
\end{frame}

The mesh equations for this system are
\[
\begin{bmatrix} P_{in}(s) \\ 0  \end{bmatrix} = \begin{bmatrix} \frac{\rho g}{sA_{1}} & -\frac{\rho g}{sA_{1}}  \\
-\frac{\rho g}{sA_{1}} & \frac{\rho g}{sA_{1}} +R_{1}   \end{bmatrix} \begin{bmatrix} Q_{1}(s) \\ Q_{out}(s) \end{bmatrix}
\]

To find $P_{1}$, we can write
\[
P_{1}(s) = R_{1}Q_{out}(s)
\]


\section{Quiz Yourself}

\subsection{Questions}


\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item The following is a model for the lateral motion of a building subject to an earthquake. $x_{f}$ is the position of the foundation of the building relative to a fixed point. During an earthquake, $x_{f}$ becomes a function of time, and will be considered the input. The horizontal position of the top of the building is $x_{t}$. Find the transfer function from $x_{f}$ to $x_{t}$.\vspace{-.2in}
\begin{center}
\input{quizfigures/mechprob.tex}
\end{center}
\item Two tanks are connected in series, with the supply at pressure $p_{in}$. Find the equations that describe the behavior of the tanks, including the height of the second tank, $h_{2}$.

\begin{center}
\input{quizfigures/fluidsystem.tex}
\end{center}
\item 

\end{enumerate}

\subsection{Solutions}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item \rule{0pt}{12pt}\\
\begin{center}
\includegraphics[width=5in]{quizfigures/1soln}
\end{center}
\item To find the equations, we can replace each element with the impedance equivalent, along with a ``pressure source''.  Note that there are three identifiable pressures - the pressure at the bottom of each tank, $p_{1}$ and $p_{2}$ and the atmospheric pressure $p_{a}$. Our circuit should thus have three identifiable voltage nodes (one of which will be ground)

\begin{frame}{Two tank mesh}
\begin{center}
\input{figures/2tankmesh.tex}
\end{center}
\end{frame}

The mesh equations for this system are
\[
\begin{bmatrix} P_{in}(s) \\ 0 \\ 0 \end{bmatrix} = \begin{bmatrix} \frac{\rho g}{sA_{1}} & -\frac{\rho g}{sA_{1}} & 0 \\
-\frac{\rho g}{sA_{1}} & \frac{\rho g}{sA_{1}} +R_{1} + \frac{\rho g}{sA_{2}} & -\frac{\rho g}{sA_{2}} \\
0 & -\frac{\rho g}{sA_{2}} & \frac{\rho g}{sA_{2}} +R_{2} \end{bmatrix} \begin{bmatrix} Q_{1}(s) \\ Q_{2}(s) \\ Q_{out}(s) \end{bmatrix}
\]
To find the relationship with $h_{2}$, we can write
\[
P_{2}(s) = R_{2}Q_{out}(s),
\]
and use the fact that
\[
H_{2}(s) = \frac{ P_{2}(s)}{\rho g}.
\]
\end{enumerate}



\end{document}


