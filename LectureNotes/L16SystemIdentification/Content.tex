\mode<presentation>
{
  \usetheme{CambridgeUS}
  \usecolortheme{whale}
  \usecolortheme{lily}

  \setbeamercovered{transparent}
  \usefonttheme[onlymath]{serif}
}

\title[\SystemIdentificationShortName] 
{\course: \SystemIdentificationName\license}

\subtitle
{Lecture \SystemIdentificationNumber} 

\author[\instructorshort]% (optional, use only with lots of authors)
{\instructorlong\credits}

\institute[\instituteshort] % (optional, but mostly needed)
{\institutelong}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\mode<article>{
\maketitle
\tableofcontents
}

\section{Pre-requisite Material}
This lecture assumes that the reader is familiar with the following material:
\begin{itemize}
\item Lecture \IntroToSimulinkNumber:~\IntroToSimulinkName
%\item Lecture \FluidandAnalogousSystemsNumber:~\FluidandAnalogousSystemsName
%\item Lecture \ThermalSystemsNumber:~\ThermalSystemsName
\item Lecture \FirstOrderResponseNumber:~\FirstOrderResponseName
\item Lecture \SecondOrderResponseNumber:~\SecondOrderResponseName
\item Lecture \RotationalAndFluidSystemsNumber:~\RotationalAndFluidSystemsName
\end{itemize}


\section{System Identification}

In the first part of this course, we examined methods for developing models of different types of systems. One complication  of these models is that there are many parameters that need to be known - i.e. mass, spring constants and damping in mechanical systems, thermal capacitance and resistance in thermal systems, etc. In some cases these parameters can be measured directly, but in others they cannot. In cases when the parameters cannot be measured, we can turn to {\em system identification} in which experimental data is used to find the appropriate transfer function. 

\section{Model Structure}

Even if our modeling process leaves us with lots of unknown parameters, it still is a worthwhile exercise, as it can give us some insight into the expected {\em model structure}. The model structure is the number of poles and zeros that a transfer function has (although not their location), plus any other additional information, like time delays or whether there are undamped poles. The model structure lets us know how many parameters we are looking for, and gives us hints on how to find them from experimental data. 

In the previous lectures, we have seen many examples of different types of model structures, such as those in the following table.

\begin{frame}
\begin{center}
\mode<article>{
\begin{tabular}{p{2in}cc}
Model Structure & Transfer Function & Example System \\\hline
First order system & $\displaystyle K\frac{\sigma}{s+\sigma}$ &\begin{minipage}{3.5cm}\begin{center}\rule{0pt}{14pt} Oven \\ \rule{0cm}{2cm}\resizebox{3.5cm}{!}{\input{figures/ovendiag}}\end{center}\end{minipage} \\
 & & Note: a 1-tank fluid system would also be first order \\
Second order system, underdamped & $\displaystyle K\frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s+\omega_{n}^{2}}$ & \begin{minipage}{4.5cm}\begin{center}\rule{0pt}{18pt} Mechanical System \\ \rule{0cm}{2cm}\resizebox{4.5cm}{!}{\input{figures/rotmechsystem}} \end{center}\end{minipage} \\
 & & \\
Second order system, overdamped &  $\displaystyle K\frac{\sigma_{1}\sigma_{2}}{(s+\sigma_{1})(s+\sigma_{2})}$ & \begin{minipage}{5.5cm}\begin{center}\rule{0pt}{18pt} Two Tank System \\ \rule{0cm}{2cm}\resizebox{5.5cm}{!}{\input{figures/2tank}} \end{center}\end{minipage} \\
\end{tabular}}

\mode<presentation>{\resizebox{11cm}{!}{
\begin{tabular}{p{2in}cc}
Model Structure & Transfer Function & Example System \\\hline
First order system & $\displaystyle K\frac{\sigma}{s+\sigma}$ &\begin{minipage}{3.5cm}\begin{center}\rule{0pt}{14pt} Oven \\ \rule{0cm}{2cm}\resizebox{3.5cm}{!}{\input{figures/ovendiag}}\end{center}\end{minipage} \\
Second order system, underdamped & $\displaystyle K\frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s+\omega_{n}^{2}}$ & \begin{minipage}{4.5cm}\begin{center}\rule{0pt}{18pt} Mechanical System \\ \rule{0cm}{2cm}\resizebox{4.5cm}{!}{\input{figures/rotmechsystem}} \end{center}\end{minipage} \\
Second order system, overdamped &  $\displaystyle K\frac{\sigma_{1}\sigma_{2}}{(s+\sigma_{1})(s+\sigma_{2})}$ & \begin{minipage}{5.5cm}\begin{center}\rule{0pt}{18pt} Two Tank System \\ \rule{0cm}{2cm}\resizebox{5.5cm}{!}{\input{figures/2tank}} \end{center}\end{minipage} \\
\end{tabular}}}
\end{center}
\end{frame}

Let's see how we can find the model structure for a two-tank system with two sources. 

\begin{frame}{Fluid System Diagram} 
\begin{center}
\input{figures/fluidsystem.tex}
\end{center}
\end{frame}

An equivalent impedance network can be formed starting with the two tank pressure nodes $p_1$ and $p_2$ and using atmospheric pressure as our ground.

\begin{frame}{Fluid System Impedance Network}
\begin{center}
\input{figures/2tankimpedance.tex}
\end{center}
\end{frame}

We have two sources: a voltage source $P_{in}$ and a current source $Q_{in}$. We know from the superposition property of linear systems that we can find the transfer functions $G(s)$ from each input to the output $Q_{out}$ independently, resulting in the overall system equation 
\[
Q_{out}(s) = G_P(s) P_{in}(s) + G_Q(s) Q_{in}(s).
\]

Let's start by finding the transfer function from the pressure source to the output, $G_P(s)$. To do this, we set $Q_in(s)=0$. A zero current means an open circuit, so our impedance network becomes
\begin{frame}{Impedance Network for $P_{in}$ Input}
\begin{center}
\input{figures/2tankimpedancePin.tex}
\end{center}
\end{frame}
where we have defined a new current through Valve 1 for use later.

The impedances of Tank 2 and Valve 2 are in parallel, so we can find their equivalent $Z_1(s)$ as
\[
Z_{1}(s) = \frac{\rho g R_2}{R_2 A_2 s + \rho g}
\]
in the following impedance network.
\begin{frame}{Impedance Network for $P_{in}$ Input - Step 2}
\begin{center}
	\input{figures/2tankimpedancePin2.tex}
\end{center}
\end{frame}

Next, combine the impedances of Valve 1 and the equivalent impedance $Z_1(s)$ in series by adding them.
\begin{align*}
Z_{2}(s) &= R_1 + \frac{\rho g R_2}{R_2 A_2 s + \rho g} \\
&= \frac{R_1 R_2 A_2 s + \rho g \left( R_1 + R_2 \right)}{R_2 A_2 s + \rho g} \\
\end{align*}
where our new impedance network is given by:
\begin{frame}{Impedance Network for $P_{in}$ Input - Step 3}
\begin{center}
	\input{figures/2tankimpedancePin3.tex}
\end{center}
\end{frame}

Now we can find the current $Q_R(s)$ from the Laplace-domain version of Ohm's Law:
\begin{align*}
Q_R(s) &= \frac{P_{in}(s)}{Z_2(s)} \\
&= \frac{R_2 A_2 s + \rho g}{R_1 R_2 A_2 s + \rho g \left(R_1 + R_2\right)} P_{in}(s)
\end{align*}

Finally, we can use current division to get $Q_{out}(s)$ from $Q_R(s)$ (see the earlier ``Impedance Network for $P_{in}$ Input'' figure):
\begin{align*}
Q_{out}(s) &= \frac{\frac{\rho g}{A_2 s}}{\frac{\rho g}{A_2 s} + R_2} Q_R(s) \\
&= \frac{\rho g}{R_1 R_2 A_2 s + \rho g \left(R_1 + R_2\right)} P_{in}(s) \\
&= \left( \frac{\frac{\rho g}{R_1 R_2 A_2}}{s+\frac{\rho g (R_1+R_2)}{R_1 R_2 A_2}} \right) P_{in}(s) \\
&= G_P(s) P_{in}(s)
\end{align*}

This is a first order transfer function, with 
\begin{align*}
G_P(s) = K \frac{\sigma}{s+\sigma}
\end{align*}
where
\begin{align*}
\sigma &= \frac{\rho g \left(R_1+R_2\right)}{R_1 R_2 A_2} \\
K &= \frac{1}{R_1 + R_2}
\end{align*}

To find the transfer function from $Q_{in}(s)$ to $Q_{out}(s)$, we set $P_{in}=0$ (making a short circuit) and use the following impedance network.
\begin{frame}{Impedance Network for $Q_{in}$ Input}
\begin{center}
\input{figures/2tankimpedanceQin.tex}
\end{center}
\end{frame}
Note that in this case, Tank 1 is essentially removed from the system (all current would flow through the short circuit in parallel). This result makes sense if we go back to the initial system diagram and note that $q_{in}$ flows into Tank 2. 

In this case, all three remaining impedances (for Valve 1, Valve 2, and Tank 2) are in parallel, and the transfer function becomes
\begin{align*}
Q_{out}(s) &= \frac{R_1 \rho g}{R_1 R_2 A_2 s + \rho g \left(R_1 + R_2\right)} Q_{in}(s) \\
 &= K_2 \frac{\sigma}{s + \sigma} Q_{in}(s) \\
 &= G_Q(s) Q_{in}(s) \\
\end{align*}
where
\begin{align*}
K_2 &= \frac{R_1}{R_1 + R_2} \\
 &= R_1 K
\end{align*}
Note that, like $G_P(s)$, $G_Q(s)$ is also a first order system and that they the same $\sigma$ (as expected).

Finally, 
\[
Q_{out}(s) = K \frac{\sigma}{s+\sigma} P_{in}(s) + R_1 K \frac{\sigma}{s+\sigma} Q_{in}(s).
\]

%We don't know the parameters $K_1$ and $\sigma$, but this equation defines the structure of our model, and provides a basis for estimating these parameters from data.
%
%We can make the following observations
%\begin{enumerate}
%\item While the original model had many physical parameters (i.e. tank capacitances and valve resistances) to characterize the dynamic response, we only need to know $\sigma$, $K_1$, and $R_1$.
%%\item Knowing the dependence of the physical parameters on $\sigma$ and $K_1$ is useful, however, since we can see how physical changes would affect the dynamics. For example, if the mass flow increased, which would decrease $R_{v}$, then $K$ would decrease and $\sigma$ would increase.
%\item Our model has two inputs, but we have control over only one of them, the heat input $v_{h}$. The other input, $T_{a}$ is a {\em disturbance}. Fortunately, in this case, we expect $T_{a}$ to be a known constant. Since $T_{a}$ will be a constant {\em before} the experiment begins, the term $\frac{\sigma}{s+\sigma}T_{a}(s)$ will simply be the constant $\frac{T_{a}}{s}$, and
%\[
%T_{o}(s) =  K\frac{\sigma}{s+\sigma}V_{h}(s) + \frac{T_{a}}{s}.
%\]
%\end{enumerate}

In the next section, we look at how we can use experimental data to estimate the parameters.

\section{Step Response Experiments}

If we have a first or second order system, then a step response experiment will be a good way to identify the parameters, since we know how the characteristics of the step response are related to the transfer function parameters. 

\subsection{First Order Response}
Recall from previous lectures that the unit step response has the form
\[
y(t) = K(1-e^{-\sigma t})
\]
\begin{frame}{Unit Step Response Plot - First order system}
\begin{center}
\includegraphics[width=3in]{figures/stepresponse}
\end{center}
\end{frame}
The parameter $K$ can be found from the {\em steady state} value of the step response, while $\sigma$ can be found from the rate of increase. A particularly easy point to locate is the time at which the magnitude is $64\%$ of the steady state value. This occurs at one time constant $t=\frac{1}{\sigma}$, which is one over the pole magnitude.

\begin{example}
Let's suppose we do a step response experiment that changes the pressure $p_{in}=760$mmHg (i.e., atmospheric pressure) to $p_{in}=790$mmHg at $t=0$ and we measure the output flow rate $q_{out}(t)$, with the measurement denoted as $\tilde{q}_{out}(t)$. Note: our systems above treat atmospheric pressure as ground, but the data in this section includes 760mmHg since that's how it would show up in a measurement in a real experiment. Assume that $q_{in}(t)$ is such that there is some initial flow $q_{out}(0)=1~m^3/s$ out of Tank 2. The response is plotted below:

\begin{frame}{Pressure and Flow Experiment}
\begin{center}
\includegraphics[height=2.9in]{figures/pressureexperiment1}
\end{center}
\end{frame}

Our first step will be to pre-process the data. This can involve
\begin{itemize}
\item \textbf{Setting the response at time $t=0$ to zero to remove the effect of other inputs, or the operating point.} From the problem statement, we know that we'll need to subtract the initial flow rate $q_{out}(0)=1~\mathrm{m}^3$/s from the data. 
\item \textbf{Scaling the response by the input magnitude so that it becomes a unit step response.} In the graph above, the input signal was $p_{in}(t) = 30u(t)$ or $P_{in}(s) = \frac{30}{s}$. Since we want to compare this to a {\em unit} step response (i.e. $P_{in}(s) = \frac{1}{s}$), we should divide $\tilde{q}_{out}(t)$ by 30. 
\item \textbf{Applying filtering to remove noise.}
\end{itemize}

In this case, we will do the first two items. We will subtract the initial flow rate of $1~\mathrm{m}^3$/s from the output, and then divide by 30, to get the following:

\begin{frame}{Scaled Tank Experiment - Unit Step Response}
\begin{center}
\includegraphics[height=2.9in]{figures/pressureexperiment2}
\end{center}
\end{frame}
From this graph, we can estimate $K=0.042$. We calculate $.64\times 0.042 = 0.027$ and look for the time at which the response magnitude crosses $0.027$. This appears to be about 0.9 seconds, giving us a time constant of 0.9 s, and $\sigma=1/0.9 = 1.11$. Thus, our estimate for the transfer function is
\[
Q_{out}(s) = 0.042\frac{1.11}{s+1.11}P_{in}(s)
\]
\end{example}

\subsection{Second Order Systems}
If we have an underdamped second order system, the step response is expected to look as follows
\begin{frame}{Unit Step Response Plot - Second Order System}
\begin{center}
\includegraphics[width=3in]{figures/stepreseponsespecifications}
\end{center}
\end{frame}
Again, the parameter $K$ can be found from the steady state. The damping ratio is best found from measuring the percent overshoot
\[
\%OS = \frac{M_{p}}{K}\times 100\%,
\]
and using the formula
\[
\zeta = -\frac{\ln(\%OS/100)}{\sqrt{\ln(\%OS/100)^2+\pi^2}}.
\]
The natural frequency $\omega_{n}$ can then be found from either the rise time or settling time specification.

\begin{example}
Consider the following mass spring damper system
\begin{frame}
\begin{center}
\input{figures/rotmechsystem}
\end{center}
\end{frame}
In an experiment, a unit (1 Nm) torque is applied and the following step response for $\theta$ is observed
\begin{frame}
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment1}
\end{center}
\end{frame}
Find the transfer function $\theta(s)/\tau(s)$, and find values for the physical parameters $J$, $k$, and $b$.
\end{example}
\textbf{Solution:} The model structure for a mass spring damper transfer function is
\[
\theta(s)/\tau(s) = \frac{1}{Js^{2}+bs+k} = \left( \frac{1}{k} \right) \frac{k/J}{s^{2} + (b/J)s+(k/J)}
\]
This is a second order system, and we can make the following associations with the canonical second order parameters
\[
(1/k) = K\quad (b/J) = 2\zeta\omega_{n} \quad (k/J) = \omega_{n}^{2}
\]
From the step response, we can estimate the following features
\begin{align*}
K &= 13 \\
\OS &= (19-13)/13 \times 100\% = 46\%\\
\ts &= 18\mbox{s}\\
\tr  &= 1.75 \mbox{s}\\
\end{align*}
From the overshoot, we estimate
\[
\zeta = -\ln(.46)/\sqrt{\ln(.46)^2+\pi^2} = 0.24
\]
From the rise time, we estimate
\[
\omega_{n} = \frac{2.2}{\tr} = \frac{2.2}{1.75} = 1.25
\]
Using these estimates of $\omega_{n}$ and $\zeta$ we obtain a settling time estimate of 
\[
\ts= \frac{4.6}{\omega_{n} \zeta} = \frac{4.6}{(1.25)(0.24)} = 15 \mbox{s}
\]
which from the graph appears reasonable. The step response of the transfer function
\[
\hat{G}(s) = \frac{13 (1.25^2)}{s^{2}+2(0.24)(1.25)s + 1.25^2}
\]
is the following:
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment2}
\end{center}
Comparing with the experimental step response, the main difference appears to be the frequency of oscillation, which is faster in our model than in the experiment. This can be adjusted by lowering $\omega_{n}$ by choosing $\omega_{n} = 0.75$, our model becomes 
\[
\hat{G}(s) = \frac{13 (0.75^2)}{s^{2}+2(0.24)(0.75)s + 0.75^2}
\]
whose step response below appears to be a very good match to experiment.
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment3}
\end{center}

\section{Lecture Highlights}
The primary takeaways from this article include
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item System identification (``SysID'') is useful for estimating a system's transfer function when we know something about the transfer function's structure but can't measure all of its parameters.
\item To perform SysID, it is often useful to ``excite'' the system with a step input, measure the time response of the output signal, then measure the output signal's rise time, settling time, and percent overshoot. These three parameters can then be used to predict the system's dominant pole locations.
\item In addition, we can measure the final value of the output signal and compare it to the value of the input signal to find the ``DC gain'' of the system.
\item Although for most of this semester we study single input, single output (SISO) systems, it is possible for systems to have multiple inputs and outputs. For example, the thermal system for the MEL experiment described in this lecture has two inputs. 
\item In general, for a linear system with $n$ inputs $R_1(s)$, $R_2(s)$, ... $R_n(s)$, the output signal $Y(s) = G_1(s) R_1(s) + G_2(s) R_2(s) + ... + G_n(s) R_n(s)$. Each of the individual transfer functions $G_i(s)$ can be found by \textit {setting all other inputs except $R_i(s)$ equal to zero}.
\end{enumerate}


\newpage
\section{Quiz Yourself}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item Match the transfer function to the step response
\begin{center}
\input{quizfigures/stepcompare}
\end{center}
\end{enumerate}
\pagebreak

\subsection{Solutions}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item The key parameters for the transfer functions are
\begin{enumerate}
\renewcommand{\labelenumii}{(\roman{enumii})}
\item $K=1$, $\omega_{n} = 5$, $\zeta=0.5$
\item $K=1$, $\omega_{n} = .5$, $\zeta=0.5$
\item $K=1$, $\omega_{n} = 5$, $\zeta=1.5$ - overdamped. Denominator can be factored as $(s+13.1)(s+1.91)$. Slowest pole dominates, so $\sigma\approx 1.91$
\item $K=1$, $\omega_{n} = .5$, $\zeta=1.5$ - overdamped. Denominator can be factored as $(s+1.31)(s+.191)$. Slowest pole dominates, so $\sigma \approx .191$. 
\item $K=0.1$, $\sigma=10$
\item slowest pole dominates: $K=1$, $\sigma=1$. This will be a good approximation since the slowest pole is 10x closer to the origin.
\end{enumerate}

Rough estimates of the step response characteristics are the following (the estimate of the time constant comes from the time when the response is .64 of the steady state value)
%\renewcommand{\theenumii}{\alpha{enumii}}
\begin{enumerate}[(a)]
\item $K=1$, $t_{r} = 2.2s$, $t_{s}=3.5s$, overdamped, time constant $1.2s$
\item $K=1$, $t_{r} = 11s$, $t_{s} = 18s$, overdamped, time constant $7s$
\item $K=0.1$, $t_{r} = .22s$, $t_{s} = .35s$, overdamped, time constant $.12$
\item $K=1$, $t_{r} = .4s$, $t_{s} = 1.5s$, overshoot $15\%$.
\item $K=1$, $t_{r} = 1.5s$, $t_{s} = 2s$, overdamped, time constant $.7s$
\item $K=1$, $t_{r} = 3s$, $t_{s} = 15s$, overshoot $15\%$.
\end{enumerate}
The two unambiguously second order systems are (d) and (f). 

From the rise time and overshoot specification we estimate for (d)
\begin{align*}
\omega_{n} &= \frac{2.2}{t_{r}}  = \frac{2.2}{.4} = 5.5\\
\zeta & = -\frac{\ln(.15)}{\sqrt{\ln(.15)^2+\pi^2}} = .52
\end{align*}
This would predict a settling time of
\[
t_{s} =  \frac{4.6}{5.5(.52)} = 1.6 s
\]
which is fairly close to our estimate of $1.5$s. These parameters match up well with system (i).

From the rise time and overshoot specification we estimate for (f)
\begin{align*}
\omega_{n} &= \frac{2.2}{t_{r}}  = \frac{2.2}{3} = .73\\
\zeta & = -\frac{\ln(.15)}{\sqrt{\ln(.15)^2+\pi^2}} = .52
\end{align*}
This would predict a settling time of
\[
t_{s} =  \frac{4.6}{.73(.52)} = 12 s
\]
which is close to our estimate of $15$s. These parameters match up well with system (ii).

Since the other systems are overdamped, we should compare the time constant estimates to the dominant (or only poles), while also checking the DC gain $K$. 

The only DC gain less than 1 is (c) which must match system (v). This is confirmed by the time constant .12 being approximately the same as $1/\sigma = 1/10$.

Response (a) has a time constant of 1.2s, which implies a pole location of $1/1.2 = .83$. This is closest to system (vi).

Response (b) has a time constant of 7s, which implies a pole location of $1/7=.14$. This is closest to system (iv)

Finally, response (e) has a time constant of .7 seconds, which implies a pole location of $1/.7=1.4$. This is closest to system (iii).

Our final answer is
\begin{center}
(a) $\rightarrow$ (vi)\\
(b) $\rightarrow$ (iv) \\
(c) $\rightarrow$ (v)\\
(d) $\rightarrow$ (i)\\
(e) $\rightarrow$ (iii)\\
(f) $\rightarrow$ (ii)
\end{center}
 
\end{enumerate}

\section{Resources}

\subsection{Books}


\begin{itemize}
\item Gene F. Franklin, J. David Powell and Abbas Emami-Naeini,  {\em Feedback Control of Dynamic Systems}, Pearson
\begin{itemize}
\item 6th and 7th edition: Section 3.7
\end{itemize}
\end{itemize}


\subsection{Web resources}

If you find any useful web resources, please let your instructor know.



\end{document}


