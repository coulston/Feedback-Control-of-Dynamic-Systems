\mode<presentation>
{
  \usetheme{CambridgeUS}
  \usecolortheme{whale}
  \usecolortheme{lily}

  \setbeamercovered{transparent}
  \usefonttheme[onlymath]{serif}
}

\title[\SystemIdentificationShortName] 
{\course: \SystemIdentificationName\license}

\subtitle
{Lecture \SystemIdentificationNumber} 

\author[\instructorshort]% (optional, use only with lots of authors)
{\instructorlong\credits}

\institute[\instituteshort] % (optional, but mostly needed)
{\institutelong}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\mode<article>{
\maketitle
\tableofcontents
}

\section{Pre-requisite Material}
This lecture assumes that the reader is familiar with the following material:
\begin{itemize}
\item Lecture \IntroToSimulinkNumber:~\IntroToSimulinkName
%\item Lecture \FluidandAnalogousSystemsNumber:~\FluidandAnalogousSystemsName
%\item Lecture \ThermalSystemsNumber:~\ThermalSystemsName
\item Lecture \FirstOrderResponseNumber:~\FirstOrderResponseName
\item Lecture \SecondOrderResponseNumber:~\SecondOrderResponseName
\item Lecture \RotationalAndFluidSystemsNumber:~\RotationalAndFluidSystemsName
\end{itemize}


\section{System Identification}

In the first part of this course, we examined methods for developing models of different types of systems. One complication  of these models is that there are many parameters that need to be known - i.e. mass, spring constants and damping in mechanical systems, thermal capacitance and resistance in thermal systems, etc. In some cases these parameters can be measured directly, but in others they cannot. In cases when the parameters cannot be measured, we can turn to {\em system identification} in which experimental data is used to find the appropriate transfer function. 

\section{Model Structure}

Even if our modeling process leaves us with lots of unknown parameters, it still is a worthwhile exercise, as it can give us some insight into the expected {\em model structure}. The model structure is the number of poles and zeros that a transfer function has (although not their location), plus any other additional information, like time delays or whether there are undamped poles. The model structure lets us know how many parameters we are looking for, and gives us hints on how to find them from experimental data. 

In the previous lectures, we have seen many examples of different types of model structures, such as those in the following table.

\begin{frame}
\begin{center}
\mode<article>{
\begin{tabular}{p{2in}cc}
Model Structure & Transfer Function & Example System \\\hline
First order system & $\displaystyle K\frac{\sigma}{s+\sigma}$ &\begin{minipage}{3.5cm}\begin{center}\rule{0pt}{14pt} Oven \\ \rule{0cm}{2cm}\resizebox{3.5cm}{!}{\input{figures/ovendiag}}\end{center}\end{minipage} \\
Second order system, underdamped & $\displaystyle K\frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s+\omega_{n}^{2}}$ & \begin{minipage}{4.5cm}\begin{center}\rule{0pt}{18pt} Mechanical System \\ \rule{0cm}{2cm}\resizebox{4.5cm}{!}{\input{figures/rotmechsystem}} \end{center}\end{minipage} \\
Second order system, overdamped &  $\displaystyle K\frac{\sigma_{1}\sigma_{2}}{(s+\sigma_{1})(s+\sigma_{2})}$ & \begin{minipage}{5.5cm}\begin{center}\rule{0pt}{18pt} Two Tank System \\ \rule{0cm}{2cm}\resizebox{5.5cm}{!}{\input{figures/2tank}} \end{center}\end{minipage} \\
\end{tabular}}

\mode<presentation>{\resizebox{11cm}{!}{
\begin{tabular}{p{2in}cc}
Model Structure & Transfer Function & Example System \\\hline
First order system & $\displaystyle K\frac{\sigma}{s+\sigma}$ &\begin{minipage}{3.5cm}\begin{center}\rule{0pt}{14pt} Oven \\ \rule{0cm}{2cm}\resizebox{3.5cm}{!}{\input{figures/ovendiag}}\end{center}\end{minipage} \\
Second order system, underdamped & $\displaystyle K\frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s+\omega_{n}^{2}}$ & \begin{minipage}{4.5cm}\begin{center}\rule{0pt}{18pt} Mechanical System \\ \rule{0cm}{2cm}\resizebox{4.5cm}{!}{\input{figures/rotmechsystem}} \end{center}\end{minipage} \\
Second order system, overdamped &  $\displaystyle K\frac{\sigma_{1}\sigma_{2}}{(s+\sigma_{1})(s+\sigma_{2})}$ & \begin{minipage}{5.5cm}\begin{center}\rule{0pt}{18pt} Two Tank System \\ \rule{0cm}{2cm}\resizebox{5.5cm}{!}{\input{figures/2tank}} \end{center}\end{minipage} \\
\end{tabular}}}
\end{center}
\end{frame}

Let's see how we can find the model structure for the MEL III thermal experiment. 

\begin{frame}{Experiment Diagram}
\begin{center}
\input{figures/meloven.tex}
\end{center}
\end{frame}

So that we don't confuse ourselves, let's define $R_{v}=\frac{1}{\dot{m}c}$, the thermal resistance due to conduction. Also, in the experiment, the heat flow $\dot{Q}$ is set by the computer by controlling a voltage signal through a D/A converter, which we will call $v_{h}$. There will be a relationship between this voltage and the heat flow, which for this example we will assume is linear, so that
\[
\dot{Q}=K_{h}v_{h}.
\]
(Note that this is {\em not} true if $v_{h}$ is the actual voltage applied to the heater circuit, so be careful! In general we are assuming that you can calculate a signal $v_{h}$ that is proportional to $\dot{Q}$.)
When we convert to ideal elements, we have the following thermal circuit.

\begin{frame}{Thermal circuit}
\begin{center}
\input{figures/melcircuit2.tex}
\end{center}
\end{frame}

We can replace the input heat flow $\dot{Q}$ with $K_{h}v_{h}$, and since the buffer is buffering an ideal voltage source, we can remove it, resulting in the following

\begin{frame}{Simplified Thermal circuit}
\begin{center}
\input{figures/melcircuit3.tex}
\end{center}
\end{frame}

We will measure temperature in Celsius, so $T_{ref}=0^{\circ}$ C. Note that there are two inputs that we need to consider: $T_{a}$, the ambient temperature, and $v_{h}$, the heater control. The output is the measured air temperature, $T_{o}$. Using superposition, we first set $T_{a}=0$ and solve the following impedance network to find the transfer function from $v_{h}$ to $T_{o}$

\begin{frame}{Impedance Network for $v_{h}$ input}
\begin{center}
\input{figures/melcircuit4.tex}
\end{center}
\end{frame}

Since all the impedances are in parallel, to find the equivalent impedance, we can add them together as admittances, and then take the inverse
\[
Z_{eq}(s) = \frac{1}{\frac{1}{R_{v}}+ \frac{1}{R} +sC}
\]
Then
\begin{align*}
T_{o}(s) &=  \frac{\frac{1}{C}}{s+ \frac{1}{C}\left(\frac{R+ R_{v}}{RR_{v}}\right)}K_{h}V_{h}(s)\\
& = K\frac{\sigma}{s+\sigma}V_{h}(s)
\end{align*}
This is a first order transfer function, with 
\begin{align*}
\sigma &=  \frac{1}{C}\left(\frac{R+R_{v}}{RR_{v}}\right), \\
K & = \frac{K_{h}}{\left(\frac{R+ R_{v}}{R R_{v}}\right)} = \frac{K_{h}RR_{v}}{R+R_{v}}
\end{align*}.

To find the transfer function from $T_{a}$, we set $v_{h}=0$ and use the following circuit.
\begin{frame}{Impedance Network for $T_{a}$ input}
\begin{center}
\input{figures/melcircuit5.tex}
\end{center}
\end{frame}
In this case, $T_{o}$ can be found using the voltage divider rule
\begin{align*}
T_{o}(s) &= \frac{\frac{1}{sC}}{\frac{1}{sC}+\frac{RR_{v}}{R+R_{v}}}T_{a}(s)\\
& = \frac{R+R_{v}}{sCRR_{V}+  (R+R_{v})}T_{a}(s)\\
& = \frac{\frac{1}{C}\left(\frac{R+R_{v}}{RR_{v}}\right)}{s+\frac{1}{C}\left(\frac{R+R_{v}}{RR_{v}}\right)}T_{a}(s).
\end{align*}
This is also a first order system, with the same $\sigma$ as before,  but with $K=1$.

The observed temperature is thus a linear combination of these two inputs
\[
T_{o}(s) =  K\frac{\sigma}{s+\sigma}V_{h}(s) + \frac{\sigma}{s+\sigma}T_{a}(s).
\]
We don't know the parameters $K$ and $\sigma$, but this equation defines the structure of our model, and provides a basis for estimating these parameters from data.

We can make the following observations
\begin{enumerate}
\item While the original model had many physical parameters (i.e. thermal capacitance $C$, thermal resistance $R$, mass flow $\dot{m}$, air heat capacity $c$, and heater proportionality constant $K_{h}$) to characterize the dynamic response, we only need to know $\sigma$ and $K$, which are the particular combinations of these parameters given by
\begin{align*}
\sigma &=  \frac{1}{C}\left(\frac{R+R_{v}}{RR_{v}}\right), \\
K &= \frac{K_{h}RR_{v}}{R+R_{v}}.
\end{align*}
We simply need to find these two parameters.
\item Knowing the dependence of the physical parameters on $\sigma$ and $K$ is useful, however, since we can see how physical changes would affect the dynamics. For example, if the mass flow increased, which would decrease $R_{v}$, then $K$ would decrease and $\sigma$ would increase.
\item Our model has two inputs, but we have control over only one of them, the heat input $v_{h}$. The other input, $T_{a}$ is a {\em disturbance}. Fortunately, in this case, we expect $T_{a}$ to be a known constant. Since $T_{a}$ will be a constant {\em before} the experiment begins, the term $\frac{\sigma}{s+\sigma}T_{a}(s)$ will simply be the constant $\frac{T_{a}}{s}$, and
\[
T_{o}(s) =  K\frac{\sigma}{s+\sigma}V_{h}(s) + \frac{T_{a}}{s}.
\]
\end{enumerate}

In the next section, we look at how we can use experimental data to estimate the parameters.

\section{Step Response Experiments}

If we have a first or second order system, then a step response experiment will be a good way to identify the parameters, since we know how the characteristics of the step response are related to the transfer function parameters. 

\subsection{First Order Response}
Recall from previous lectures that the unit step response has the form
\[
y(t) = K(1-e^{-\sigma t})
\]
\begin{frame}{Unit Step Response Plot - First order system}
\begin{center}
\includegraphics[width=3in]{figures/stepresponse}
\end{center}
\end{frame}
The parameter $K$ can be found from the {\em steady state} value of the step response, while $\sigma$ can be found from the rate of increase. A particularly easy point to locate is the time at which the magnitude is $64\%$ of the steady state value. This occurs at one time constant $t=\frac{1}{\sigma}$, which is one over the pole magnitude.

\begin{example}
Let's suppose we do a step response experiment that changes $v_{h}=0$V to $v_{h}=3$V at $t=0$, and we measure thermocouple \#1. The response is plotted below:

\begin{frame}{Heater Experiment}
\begin{center}
\includegraphics[height=2.9in]{figures/heaterexperiment1}
\end{center}
\end{frame}

Our first step will be to pre-process the data. This can involve
\begin{itemize}
\item \textbf{Setting the response at time $t=0$ to zero to remove the effect of other inputs, or the operating point.} From observation \#3 in Section 2, we know that
\[
T_{o}(s) =  K\frac{\sigma}{s+\sigma}V_{h}(s) + \frac{T_{a}}{s}.
\]
or 
\[
T_{0}(t) = \tilde{T}_{0}(t) + T_{a}
\]
where $\mathcal{L}\left\{\tilde{T}_{0}(t) \right\}= K\frac{\sigma}{s+\sigma}V_{h}(s)$. Since it is $\tilde{T}_{0}$ that contains the information about the transfer function that we are interested in, we need to subtract $T_{a}$ from $T_{0}(t)$ to see it. 
\item \textbf{Scaling the response by the input magnitude so that it becomes a unit step response.} In the graph above, the input signal was $v_{h}(t) = 3u(t)$ or $V_{h}(s) = \frac{3}{s}$. Since we want to compare this to a {\em unit} step response (i.e. $V_{h}(s) = \frac{1}{s}$), we should divide $\tilde{T}_{0}(t)$ by 3. 
\item \textbf{Applying filtering to remove noise.}
\end{itemize}

In this case, we will do the first two items. We will subtract the ambient temperature of 21$^{\circ}$ C from the output, and then divide by 3, to get the following:

\begin{frame}{Scaled Heater Experiment - Unit Step Response}
\begin{center}
\includegraphics[height=2.9in]{figures/heaterexperiment2}
\end{center}
\end{frame}
From this graph, we can estimate $K=7$. We calculate $.64\times 7 = 4.48$ and look for the time at which the response magnitude crosses $4.48$. This appears to be about 20 seconds, giving us a time constant of 20 s, and $\sigma=1/20 = .05$. Thus, our estimate for the transfer function is
\[
T_{o}(s) = 7\frac{.05}{s+.05}V_{h}(s)
\]
\end{example}

\subsection{Second Order Systems}
If we have an underdamped second order system, the step response is expected to look as follows
\begin{frame}{Unit Step Response Plot - Second Order System}
\begin{center}
\includegraphics[width=3in]{figures/stepreseponsespecifications}
\end{center}
\end{frame}
Again, the parameter $K$ can be found from the steady state. The damping ratio is best found from measuring the percent overshoot
\[
\%OS = \frac{M_{p}}{K}\times 100\%,
\]
and using the formula
\[
\zeta = -\frac{\ln(\%OS/100)}{\sqrt{\ln(\%OS/100)^2+\pi^2}}.
\]
The natural frequency $\omega_{n}$ can then be found from either the rise time or settling time specification.

\begin{example}
Consider the following mass spring damper system
\begin{frame}
\begin{center}
\input{figures/rotmechsystem}
\end{center}
\end{frame}
In an experiment, a unit (1 Nm) torque is applied and the following step response for $\theta$ is observed
\begin{frame}
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment1}
\end{center}
\end{frame}
Find the transfer function $\theta(s)/\tau(s)$, and find values for the physical parameters $J$, $k$, and $b$.
\end{example}
\textbf{Solution:} The model structure for a mass spring damper transfer function is
\[
\theta(s)/\tau(s) = \frac{1}{Js^{2}+bs+k} = \left( \frac{1}{k} \right) \frac{k/J}{s^{2} + (b/J)s+(k/J)}
\]
This is a second order system, and we can make the following associations with the canonical second order parameters
\[
(1/k) = K\quad (b/J) = 2\zeta\omega_{n} \quad (k/J) = \omega_{n}^{2}
\]
From the step response, we can estimate the following features
\begin{align*}
K &= 13 \\
\OS &= (19-13)/13 \times 100\% = 46\%\\
\ts &= 18\mbox{s}\\
\tr  &= 1.75 \mbox{s}\\
\end{align*}
From the overshoot, we estimate
\[
\zeta = -\ln(.46)/\sqrt{\ln(.46)^2+\pi^2} = 0.24
\]
From the rise time, we estimate
\[
\omega_{n} = \frac{2.2}{\tr} = \frac{2.2}{1.75} = 1.25
\]
Using these estimates of $\omega_{n}$ and $\zeta$ we obtain a settling time estimate of 
\[
\ts= \frac{4.6}{\omega_{n} \zeta} = \frac{4.6}{(1.25)(0.24)} = 15 \mbox{s}
\]
which from the graph appears reasonable. The step response of the transfer function
\[
\hat{G}(s) = \frac{13 (1.25^2)}{s^{2}+2(0.24)(1.25)s + 1.25^2}
\]
is the following:
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment2}
\end{center}
Comparing with the experimental step response, the main difference appears to be the frequency of oscillation, which is faster in our model than in the experiment. This can be adjusted by lowering $\omega_{n}$ by choosing $\omega_{n} = 0.75$, our model becomes 
\[
\hat{G}(s) = \frac{13 (0.75^2)}{s^{2}+2(0.24)(0.75)s + 0.75^2}
\]
whose step response below appears to be a very good match to experiment.
\begin{center}
\includegraphics[width=3in]{figures/massspringdamperexperiment3}
\end{center}

\section{Lecture Highlights}
The primary takeaways from this article include
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item System identification (``SysID'') is useful for estimating a system's transfer function when we know something about the transfer function's structure but can't measure all of its parameters.
\item To perform SysID, it is often useful to ``excite'' the system with a step input, measure the time response of the output signal, then measure the output signal's rise time, settling time, and percent overshoot. These three parameters can then be used to predict the system's dominant pole locations.
\item In addition, we can measure the final value of the output signal and compare it to the value of the input signal to find the ``DC gain'' of the system.
\item Although for most of this semester we study single input, single output (SISO) systems, it is possible for systems to have multiple inputs and outputs. For example, the thermal system for the MEL experiment described in this lecture has two inputs. 
\item In general, for a linear system with $n$ inputs $R_1(s)$, $R_2(s)$, ... $R_n(s)$, the output signal $Y(s) = G_1(s) R_1(s) + G_2(s) R_2(s) + ... + G_n(s) R_n(s)$. Each of the individual transfer functions $G_i(s)$ can be found by \textit {setting all other inputs except $R_i(s)$ equal to zero}.
\end{enumerate}


\newpage
\section{Quiz Yourself}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item Match the transfer function to the step response
\begin{center}
\input{quizfigures/stepcompare}
\end{center}
\end{enumerate}
\pagebreak

\subsection{Solutions}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item The key parameters for the transfer functions are
\begin{enumerate}
\renewcommand{\labelenumii}{(\roman{enumii})}
\item $K=1$, $\omega_{n} = 5$, $\zeta=0.5$
\item $K=1$, $\omega_{n} = .5$, $\zeta=0.5$
\item $K=1$, $\omega_{n} = 5$, $\zeta=1.5$ - overdamped. Denominator can be factored as $(s+13.1)(s+1.91)$. Slowest pole dominates, so $\sigma\approx 1.91$
\item $K=1$, $\omega_{n} = .5$, $\zeta=1.5$ - overdamped. Denominator can be factored as $(s+1.31)(s+.191)$. Slowest pole dominates, so $\sigma \approx .191$. 
\item $K=0.1$, $\sigma=10$
\item slowest pole dominates: $K=1$, $\sigma=1$. This will be a good approximation since the slowest pole is 10x closer to the origin.
\end{enumerate}

Rough estimates of the the step response characteristics are the following (the estimate of the time constant comes from the time when the response is .64 of the steady state value)
%\renewcommand{\theenumii}{\alpha{enumii}}
\begin{enumerate}[(a)]
\item $K=1$, $t_{r} = 2.2s$, $t_{s}=3.5s$, overdamped, time constant $1.2s$
\item $K=1$, $t_{r} = 11s$, $t_{s} = 18s$, overdamped, time constant $7s$
\item $K=0.1$, $t_{r} = .22s$, $t_{s} = .35s$, overdamped, time constant $.12$
\item $K=1$, $t_{r} = .4s$, $t_{s} = 1.5s$, overshoot $15\%$.
\item $K=1$, $t_{r} = 1.5s$, $t_{s} = 2s$, overdamped, time constant $.7s$
\item $K=1$, $t_{r} = 3s$, $t_{s} = 15s$, overshoot $15\%$.
\end{enumerate}
The two unambiguously second order systems are (d) and (f). 

From the rise time and overshoot specification we estimate for (d)
\begin{align*}
\omega_{n} &= \frac{2.2}{t_{r}}  = \frac{2.2}{.4} = 5.5\\
\zeta & = -\frac{\ln(.15)}{\sqrt{\ln(.15)^2+\pi^2}} = .52
\end{align*}
This would predict a settling time of
\[
t_{s} =  \frac{4.6}{5.5(.52)} = 1.6 s
\]
which is fairly close to our estimate of $1.5$s. These parameters match up well with system (i).

From the rise time and overshoot specification we estimate for (f)
\begin{align*}
\omega_{n} &= \frac{2.2}{t_{r}}  = \frac{2.2}{3} = .73\\
\zeta & = -\frac{\ln(.15)}{\sqrt{\ln(.15)^2+\pi^2}} = .52
\end{align*}
This would predict a settling time of
\[
t_{s} =  \frac{4.6}{.73(.52)} = 12 s
\]
which is close our estimate of $15$s. These parameters match up well with system (ii).

Since the other systems are overdamped, we should compare the time constant estimates to the dominant (or only poles), while also checking the DC gain $K$. 

The only DC gain less than 1 is (c) which must match system (v). This is confirmed by the time constant .12 being approximately the same as $1/\sigma = 1/10$.

Response (a) has a time constant of 1.2s, which implies a pole location of $1/1.2 = .83$. This is closest to system (vi).

Response (b) has a time constant of 7s, which implies a pole location of $1/7=.14$. This is closest to system (iv)

Finally, response (e) has a time constant of .7 seconds, which implies a pole location of $1/.7=1.4$. This is closest to system (iii).

Our final answer is
\begin{center}
(a) $\rightarrow$ (vi)\\
(b) $\rightarrow$ (iv) \\
(c) $\rightarrow$ (v)\\
(d) $\rightarrow$ (i)\\
(e) $\rightarrow$ (iii)\\
(f) $\rightarrow$ (ii)
\end{center}
 
\end{enumerate}

\section{Resources}

\subsection{Books}


\begin{itemize}
\item Gene F. Franklin, J. David Powell and Abbas Emami-Naeini,  {\em Feedback Control of Dynamic Systems}, Pearson
\begin{itemize}
\item 6th and 7th edition: Section 3.7
\end{itemize}
\end{itemize}


\subsection{Web resources}

If you find any useful web resources, please let your instructor know.



\end{document}


