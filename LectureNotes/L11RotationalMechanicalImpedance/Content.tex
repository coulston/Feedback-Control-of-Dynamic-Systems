\mode<presentation>
{
  \usetheme{CambridgeUS}
  \usecolortheme{whale}
  \usecolortheme{lily}

  \setbeamercovered{transparent}
  \usefonttheme[onlymath]{serif}
}

\title[\RotationalAndFluidSystemsShortName] % (optional, use only with long paper titles)
{\course: \RotationalAndFluidSystemsName\license}

\subtitle
{Lecture \RotationalAndFluidSystemsNumber} % (optional)



\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\mode<article>{
\maketitle
\tableofcontents
}

%\mode<presentation>{
%\begin{frame}{Outline}
%  \tableofcontents
%  % You might wish to add the option [pausesections]
%\end{frame}}
\section{Pre-requisite Material}
This lecture assumes that the reader is familiar with the following material:
\begin{itemize}
	\item Lecture \ImpedanceNumber:~\ImpedanceName
\end{itemize}


\section{Overview: More System Analogies}
In Lecture~\ImpedanceNumber, we introduced the concept of \textit{system analogies} based on ``across'' and ``through'' variables, i.e., those that must be measured across a component (e.g. voltage, position) and those that flow through an element (e.g., current, force). In this lecture, we continue to develop analogies for two more types of systems: rotating mechanical systems and fluid systems. Although some differential equations are included, we focus on impedance-based modeling techniques. 

The following table lists the across and through variables for the modeling domains that we have discussed and will discuss in this course.
\begin{frame}{Across and Through Variables}
\begin{center}
	\begin{tabular}{|c|c|c|}
		Domain & Across Variable & Through Variable \\\hline\hline
		Electrical & Voltage & Current \\\hline
		Translational Mechanical & Position & Force \\\hline
		Fluid & Pressure & Flow \\\hline
		Rotational Mechanical & Angular Position & Torque \\\hline
%		Thermal & Temperature & Heat Flow \\\hline
	\end{tabular}
\end{center}
\end{frame}


By utilizing variables that have the same function in different domains, we can come up with system analogies. Analogous systems are systems in different domains that have the same equations (with different parameters) describing their behavior.

In this lecture, we'll demonstrate impedance-based techniques for modeling fluid and rotational mechanical systems. In each of the two following article sections, we'll 
\begin{itemize}
\setlength{\itemsep}{0pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
	\item note the across and through variables, 
	\item list the components with their component equations, 
	\item define the connection rules and boundary conditions, 
	\item give a table of the equivalent impedances for each component, and finally
	\item give an impedance example using the same steps you have previously seen for creating an impedance network: 
	\begin{itemize}
	\setlength{\itemsep}{0pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
		\item identifying and sketching nodes (including ground),
		\item connecting components between nodes, and 
		\item incorporating sources. 
	\end{itemize}
\end{itemize}



\section{Rotational Mechanical Systems}

Previously, we modeled translational motion in one direction. When objects rotate, the modeling process is similar. For rotational mechanical systems, the variables that we are modeling are 
\begin{itemize}
	\item torque, which has units of Newton meters [N m], and
	\item angular position, which has units of radians [rad]. 
\end{itemize}
Unless otherwise specified, we will always assume that the torque and position variables have these units.
We will use the following elements to describe rotational mechanical systems. 

\subsection{Components}

%\begin{frame}{Inertia}
When objects rotate, they follow the rotational version of Newton's law, which relates applied torque to angular acceleration. The scaling parameter in this case is the rotational inertia, $J$ which has units of [kg m$^{2}$].
\begin{center}
	\input{figures/inertia.tex}
\end{center}
\[
\tau = J\ddot{\theta}
\]
%\end{frame}

%\begin{frame}{Damping}
Viscous friction also applies in the rotational case. In this case, each of the ends of the damper can rotate in response to an applied torque. The scaling parameter $b$ has units of [N m s rad$^{-1}$].  
\begin{center}
	\input{figures/rotdamper.tex}
\end{center}
\[
\tau = b\dot{\theta}
\]
%\end{frame}
Note that the applied torque is always {\em equal and opposite} on both ends of the damper. 

%\begin{frame}{Spring}
A rotational spring.  Each of the ends of the spring can rotate in response to an applied torque. The scaling parameter has units of [N m rad$^{-1}$]. 
\begin{center}
	\input{figures/rotspring.tex}
\end{center}
\[
\tau = k\theta
\]
%\end{frame}
Like the damper, the applied torque is always {\em equal and opposite} on both ends of the spring. 

\subsection{Connection Rules and Boundary Conditions}

The connection rules and boundary conditions are the same as in the translational case.
\begin{itemize}
	\item When two elements are connected, the two components share the same {\em angular position}. 
	\item When two elements are connected, the torques at the connection {\em sum to zero}. 
	\item A ground fixes the position of that terminal to zero.
	\item A force or position input prescribes the force or position of that terminal.
\end{itemize}

\subsection{Impedances}
We note that the algebraic laws that relate rotational mechanical elements are {\em identical} to that of translational mechanical elements, with angular position as the across variable and torque as the through variable. We can use the following impedance elements.

\newpage \begin{frame}{Rotational Impedance}
\begin{center}
	\mode<article>{\begin{tabular}{c|ccc}
			& mass & spring & damper \\\hline
			Component & \begin{minipage}[b]{.75in}\input{figures/inertia.tex}\\\vspace{.1in}\end{minipage} & \input{figures/rotspring.tex} & \input{figures/rotdamper.tex}\\\hline
			\rule{0pt}{12pt} Component Law & $J\ddot{\theta} = \tau$ & $\tau = k\theta$ & $\tau = b\dot{\theta}$ \\\hline
			\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform & $\theta(s)= \frac{1}{Js^{2}}\tau(s)$ & $\theta(s) = \frac{1}{k}\tau(s)$ & $\theta(s) = \frac{1}{bs}\tau(s)$ \\\hline
			\begin{minipage}[b]{1.5in}\begin{center}Impedance Component \\
					(force direction agrees with positive direction)\end{center}
			\end{minipage}
			& \input{figures/inertiaimpedance.tex} & \input{figures/rotspringimpedance.tex} & \input{figures/rotdamperimpedance.tex}
	\end{tabular}}
	\mode<presentation>{\resizebox{10cm}{!}{\begin{tabular}{c|ccc}
				& mass & spring & damper \\\hline
				Component & \input{figures/inertia.tex} & \input{figures/rotspring.tex} & \input{figures/rotdamper.tex}\\\hline
				\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform & $\theta(s)= \frac{1}{Js^{2}}\tau(s)$ & $\theta(s) = \frac{1}{k}\tau(s)$ & $\theta(s) = \frac{1}{bs}\tau(s)$ \\\hline
				\begin{minipage}[b]{1.5in}\begin{center}Impedance Component \\
						(force direction agrees with positive direction)\end{center}
				\end{minipage}
				& \input{figures/inertiaimpedance.tex} & \input{figures/rotspringimpedance.tex} & \input{figures/rotdamperimpedance.tex}
	\end{tabular}}}
\end{center}
%Note that for the spring and damper, we have used $\theta = \theta_{1} - \theta_{2}$.
\end{frame}
\subsection{Example}
The process of finding the transfer function using impedances is straightforward.
\begin{enumerate}\addtocounter{enumi}{-1}
\setlength{\itemsep}{2pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item Draw a diagram of ideal elements.
\item Identify all of the independent nodes (across variables) which for mechanical systems are positions. Add a ground node or identify a fixed node as ground.
\item Connect elements between nodes, with masses and inertias always connected between one node and ground
\item Add boundary conditions as sources.
\item Use circuit techniques to find the transfer function.
\end{enumerate}

Let's try this process to model a hard disk drive read head, which is an important application of control systems. The control system must move the read head over the correct track within a few milliseconds, and hold it there despite disturbances such as external shocks or disk irregularities.

\begin{frame}{Hard Disk Drive Read Head}
In order to move the read head to the correct track and hold it there, we need to be able to predict the relationship between the motor torque $\tau$ and the angular position of the read head $\theta_2$. First, find the equivalent impedance model. Then, find the transfer function $\frac{\theta_2}{\tau}$. 

\begin{center}
\includegraphics[width=2.2in]{figures/Hard_disk_labeled}\input{figures/diskdrivepicture.tex}
\end{center}
{\tiny Photo attribution: By Ed g2s, via Wikimedia Commons}
\end{frame}

Since the arm is thin, it is flexible. This can be modeled with ideal elements by splitting the inertia between the arm and the read head, and connecting these inertias with a spring and damper. The motor applies the torque $\tau$. $J_{1}$ is the inertia of the motor axis, while $J_{2} = mr^{2}$, where $m$ is the mass of the read head, and $r$ is the radius at which it rotates. $k$ and $b$ are constants that describe the stiffness and damping characteristics of the actuator arm.


\begin{itemize}
\item[Step 0] Diagram of ideal elements
\begin{frame}{Hard Disk Drive Ideal Elements}
\begin{center}
\input{figures/diskdrivediagram.tex}
\end{center}
\end{frame}
\item[Step 1] For this problem, there are two independent positions: $\theta_{1}$ and $\theta_{2}$. 
\item[Step 2] Neither of these are fixed, so we also add a ground node.
\begin{frame}{Nodes}
\begin{center}
\input{figures/diskdrivecircuit1}
\end{center}
\end{frame}
\item[Step 3.1] Connect the correct impedance elements between nodes
\begin{frame}{Disk Drive Impedance Network}
\begin{center}
\input{figures/diskdrivecircuit2}
\end{center}
\end{frame}
\item[Step 3.2] The applied torque is a boundary condition. Since torque is a through variable, we should add a current source to the $\theta_{1}$ node. \begin{center}
\framebox{\begin{minipage}{5in}
Rule for assigning sign of sources: The current source goes {\em into} the node if a positive torque would tend to cause a positive $\theta_{1}(s)$.
\end{minipage}}\end{center}
\begin{frame}{Disk Drive Complete Circuit}
\begin{center}
\input{figures/diskdrivecircuit3}
\end{center}
\end{frame}

\item[Step 4] Find the transfer function

We can now find the transfer function from $\tau(s)$ to either $\theta_{1}(s)$ or $\theta_{2}(s)$ using our standard circuit methods. If we wanted to find $\theta_{2}(s)/\tau(s)$, the easiest way is to set up the nodal equations, which is KCL at each node.

Nodal equations:
\[
\begin{bmatrix} \tau(s) \\ 0 \end{bmatrix} = \begin{bmatrix} J_{1}s^{2} + bs + k & -(bs+k) \\
-(bs+k) & J_{2}s^{2}+bs+k \end{bmatrix} \begin{bmatrix} \theta_{1}(s) \\ \theta_{2}(s) \end{bmatrix}
\]
Solve for $\theta_{1}$ using second equation:
\[
\theta_{1}(s) = \frac{J_{2}s^{2}+bs+k}{bs+k}\theta_{2}(s)
\]
Plug into first equation:
\begin{align*}
\tau(s) &= (J_{1}s^{2} +bs +k)\frac{J_{2}s^{2}+bs+k}{bs+k}\theta_{2}(s) -  (bs+k)\theta_{2}(s)\\
& = \frac{J_{1}J_{2}s^{4} + J_{1}s^{2}(bs+k) + J_{2}s^{2}(bs +k) + (bs+k)^{2} - (bs+k)^{2}}{(bs+k)}\theta_{2}(s)\\
& = \frac{J_{1}J_{2}s^{4} + b(J_{1}+J_{2})s^{3} + k(J_{1}+J_{2})s^2}{(bs+k)}\theta_{2}(s)
\end{align*}
Thus
\[
\frac{\theta_{2}(s)}{\tau(s)} = \frac{bs+k}{J_{1}J_{2}s^{4} + b(J_{1}+J_{2})s^{3} + k(J_{1}+J_{2})s^2}
\]
\end{itemize}







%\begin{frame}{Tank example}
%Consider the problem of a single tank fed by a input at pressure $p_{in}$. Find the transfer function from $p_{in}$ to $p_{1}$. 
%\begin{center}
%\input{figures/1tank.tex}
%\end{center}
%\end{frame}

%To find the equations, we can replace each element with the impedance equivalent, along with a ``pressure source''. Since pressure is an across variable, this is like a voltage source.  Note that there are two identifiable pressures - the pressure at the bottom of the tank, $p_{1}$  and the atmospheric pressure $p_{a}$. Our circuit should thus have two identifiable voltage nodes.
%
%\begin{frame}{Tank system nodes}
%\begin{center}
%\input{figures/1tanknodes.tex}
%\end{center}
%\end{frame}
%
%We have the choice of using gauge pressure, in which case the node $p_{a}$ becomes ground. (If we do not use gauge pressure, we need to add a separate ground, along with a voltage source between ground and $p_{a}$ of magnitude $p_{a}$). However, if we do use gauge pressure, we need to define a new input relative to ground, i.e.: $p'_{in} = p_{in} - p_{a}$.
%
%\begin{frame}{Tank system impedance model}
%\begin{center}
%\input{figures/1tankmesh.tex}
%\end{center}
%\end{frame}
%
%You can now use your circuit simplifications to find any transfer function of interest.
%The mesh equations for this system are
%\[
%\begin{bmatrix} P'_{in}(s) \\ 0  \end{bmatrix} = \begin{bmatrix} \frac{\rho g}{sA_{1}} & -\frac{\rho g}{sA_{1}}  \\
%-\frac{\rho g}{sA_{1}} & \frac{\rho g}{sA_{1}} +R_{1}   \end{bmatrix} \begin{bmatrix} Q_{1}(s) \\ Q_{out}(s) \end{bmatrix}
%\]
%
%To find $P_{1}$, we can write
%\[
%P_{1}(s) = R_{1}Q_{out}(s)
%\]

%\subsection{Thermal Impedances}
%\begin{frame}
%Node equations are often useful for thermal systems.  Complete the table for thermal impedances
%
%\begin{center}
%\resizebox{11cm}{!}{\begin{tabular}{c|ccc}
%& thermal capacitance & conduction & convection \\\hline
%\rule{0pt}{14pt} Component law & $C\dot{T}=\dot{Q}$ & $T = R\dot{Q} $ & $\dot{m}c T = \dot{Q}$  \\\hline
%\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform &  & & \\\hline
%\begin{minipage}[b]{1.5in}\begin{center}Impedance Component \\
%(force direction agrees with positive direction)\end{center}
%\end{minipage}
%& \input{figures/thermalcapimpedance.tex} & \input{figures/conductionimpedance.tex} & \input{figures/conductionimpedance.tex}
%\end{tabular}}
%\end{center}
%\end{frame}



\section{Incompressible Fluid Systems}
For fluid systems, the variables that we are modeling are 
\begin{itemize}
	\item Pressure, which has units of Newtons per meter squared [Nm$^{-2}$] or equivalently [kg m$^{-1}$s$^{-2}$]
	\item Volumetric Flow, which has units of meters cubed per second [m$^{3}$s$^{-1}$]. 
\end{itemize}

\subsection{Components}

\begin{frame}{Tank}
The change in the volume $V$ of fluid inside the tank is equal to the difference between the input and output volumetric flow rates, $q_1$ and $q_2$, respectively, in this diagram: 
\begin{center}
	\input{figures/tank0.tex}
\end{center}
\end{frame}
The change in the volume of fluid in the tank with respect to time is equal to the difference between the input and output volumetric flows, so that 
\begin{equation}\label{eqn:flow1}
\frac{dV}{dt} = q_{1}-q_{2}.
\end{equation}
For a tank with constant cross-sectional area $A$ [m$^2$], $V=Ah$, and taking the derivative of both sides with respect to time gives us 
\begin{equation}\label{eqn:flow2}
\frac{dV}{dt}=A\frac{dh}{dt}.
\end{equation}
Setting (\ref{eqn:flow1}) equal to (\ref{eqn:flow2}) gives us the equation
\[
A\frac{dh}{dt} = q_{1} - q_{2}.
\]
Another way of considering this tank model is in terms of the pressure difference between the bottom and top of the tank, since $p_{1}-p_{2} = \rho g h$, where $\rho$ is the fluid density [kg m$^{-3}$], and $g$ is gravitational acceleration [m s$^{-2}$], both of which are constant. Substituting $h=\frac{p_1-p_2}{\rho g}$ results in
\[
\frac{A}{\rho g}\frac{d(p_{1}-p_{2})}{dt} = q_{1} - q_{2}.
\]


\begin{frame}{Linear Valve}
A valve causes a restriction that causes the pressure on one end of the value to be higher than the other end. When this pressure drop is proportional to the flow, the valve is linear with valve constant $R$. (Most valves are nonlinear, however.) By unit analysis, the units of valve resistance are [N s m$^{-5}$] or equivalently [kg m$^{-4}$s$^{-1}$].
\begin{center}
\input{figures/valve.tex}
\end{center}
\end{frame}

Why only two elements? We have not considered fluid inertia.

\subsection{Connection Rules and Boundary Conditions}

The connection rules and boundary conditions will sound familiar
\begin{itemize}
\item When elements are connected, the two components share the same {\em pressure}. 
\item When elements are connected, the {\em flows} sum to zero. 
\item Boundary conditions can set either the pressure or flow of one side of a component
\end{itemize}


\begin{frame}{Electrical Analogy for Fluid Elements:}{Tank}
\begin{center}
\input{figures/tankanalogy.tex}
\end{center}
\end{frame}

\begin{frame}{Electrical Analogy for Fluid Elements:}{Valve}
\begin{center}
\input{figures/valveanalogy.tex}
\end{center}
\end{frame}

\subsection{Fluid Impedances}

With these two analogies to electrical components (tank as capacitor and valve as resistor), it is very clear what the impedance of fluid components are when we want to use impedance methods to find transfer functions.

For fluid systems, we have the following impedances
\begin{frame}{Fluid Impedances}
\begin{center}
\mode<article>{\begin{tabular}{c|cc}
& valve & tank \\\hline
Component &\input{figures/valve2.tex} & \input{figures/tank2.tex} \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Component law & $p=Rq$ & $\frac{A}{\rho g}\frac{dp}{dt} = q_{in} - q_{out}$ \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform & $P(s)= RQ(s)$ & $\frac{A}{\rho g}sP(s) = Q_{in}(s)-Q_{out}(s)$ \\\hline
Impedance Component & \input{figures/valveanalogycopy.tex} & \input{figures/tankanalogycopy.tex}
\end{tabular}}
\mode<presentation>{\resizebox{11cm}{!}{
\begin{tabular}{c|cc}
& valve & tank \\\hline
Component &\input{figures/valve2.tex} & \input{figures/tank2.tex} \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Component law & $p=Rq$ & $\frac{A}{\rho g}\frac{dp}{dt} = q_{in} - q_{out}$ \\\hline
\rule[-8pt]{0pt}{0pt}\rule{0pt}{14pt} Laplace Transform & $P(s)= RQ(s)$ & $\frac{A}{\rho g}sP(s) = Q_{in}(s)-Q_{out}(s)$ \\\hline
Impedance Component & \input{figures/valveanalogycopy.tex} & \input{figures/tankanalogycopy.tex}
\end{tabular}}}
\end{center}
\end{frame}

Let's return to the earlier tank and valve system and go through the modeling process with analogous elements. 

\begin{frame}{Tank and Valve Problem}

\textit{Example:} Find the equivalent impedance model of the tank and valve system below with input flow $q_{in}$ and output flow $q_{out}$.

\begin{center}
\input{figures/tankandvalve}
\end{center}
\end{frame}

\begin{itemize}
\item[Step 1] \textbf{Identify all node variables.} For a fluid problem, the node variables are pressure. There are two unique pressure variables: $p_{1}$, the pressure at the bottom of the tank, and $p_{a}$ atmospheric pressure. Our circuit should thus have two identifiable voltage nodes.

\begin{frame}{Tank system nodes}
\begin{center}
\input{figures/1tanknodes.tex}
\end{center}
\end{frame}

\item[Step 2] \textbf{Identify one node as ground, or add a ground node.} Most node variables are relative - for example, consider the ground on a circuit diagram. All voltages are measured with respect to ground, so the ground voltage is simply what we will consider to be 0 V. Negative voltages are lower than ground, positive voltages are higher than ground. If we identify a node as the ground, then we will measure all node variables relative to this node. For fluid systems, there are two typical choices: Either choose absolute zero pressure (i.e. a vacuum) as ground, or choose atmospheric pressure as ground. Pressure measured with respect to atmospheric pressure is called {\em gauge} pressure, and the translation is 
\[
\mbox{Absolute Pressure} = \mbox{Gauge Pressure} + \mbox{Atmospheric Pressure}
\]
For this problem, we will choose to measure pressure using gauge pressure, so that node $p_{a}$ will be considered ground.

\item[Step 3] \textbf{Connect components between nodes.} Since flow is a through variable, setting the input flow is done with a current source. The flow is into the node representing pressure $p_{1}$, and all sources representing boundary conditions have the other end connected to ground. We also connect a tank (capacitance) impedance between $p_{1}$ and $p_{a}$, because the pressure at the top of the tank is $p_{a}$. A valve (resistance) impedance is connected between $p_{1}$ and $p_{a}$ because the valve transmits flow from a node at pressure $p_{1}$ to a node at pressure $p_{a}$.

\begin{frame}{Tank system impedance model}
\begin{center}
\input{figures/1tankmesh.tex}
\end{center}
\end{frame}

\end{itemize}



You can now use your circuit simplifications to find any transfer function of interest.


%The resulting analogous system is as follows.
%
%\begin{frame}{Example Analogy}
%\begin{center}
%\resizebox{10cm}{!}{\input{figures/tankandvalveanalogy.tex}}
%\end{center}
%\end{frame}

Again, it should be emphasized that in this case we have chosen the ambient pressure $p_{a}$ as the reference pressure. This means that all pressure nodes in this ``circuit'' are measured with respect to ambient pressure, so that the pressure at node $p_{1}$ is in fact $p_{1}+p_{a}$.

%\section{Application Example}
%\textcolor{red}{Fukushima nuclear reactor example currently commented out; idea is good, but needs a modeling question to be really helpful in this lecture}
%\textit{A real world example information related to a fluid system that must be carefully controlled}\\
%
%\noindent A video explaining what went wrong at the Fukushima Nuclear Reactor in 2011 is available at \url{https://www.youtube.com/watch?v=BdbitRlbLDc}
%
%These two snapshots are from the video and show (top) one of the safety feedback loops and (bottom) the water level dropping in the reactor rod cooling system.
%
%\begin{center}
%\includegraphics[width=5in]{figures/fukushima1.png}
%\end{center}
%\begin{center}
%\includegraphics[width=5in]{figures/fukushima2.png}
%\end{center}
%
%\noindent What do we need to know before we can begin to design the three separate water-cooling-based safety control loops for the nuclear reactor cooling system?\\
%
%\noindent Compare the tank example in this lecture
%\begin{center}
%\includegraphics[width=3.5in]{figures/fukushimaDiagram1.png}
%\includegraphics[width=1.5in]{figures/fukushimaDiagram2.png}
%\end{center}
%to the Fukushima set-up
%\begin{center}
%\includegraphics[width=3in]{figures/fukushima3.png}
%\end{center}
%
%\noindent What are some key simplifications?
%
%% Note: this application example needs a good modeling question associated with it

\section{Application Example}

%T\textcolor{red}{wind turbine example currently commented out}
Consider a wind turbine as a rotating mechanical system. Occasionally it is desirable to use the generator in reverse (as a motor providing torque \(\tau\)) to turn the rotor to a certain angular position \(\theta\) so that maintenance can be performed. An automatic controller can be designed to position the rotor, but before designing the controller first we need to be able \textit{to model the turbine in transfer function form}.

\begin{center}
	\includegraphics[height=2in]{figures/applicationExample/windturbine1.png}
	\includegraphics[height=2in]{figures/applicationExample/windturbine2.png}
\end{center}

\noindent \textbf{Step 0:} to model the turbine's rotor, first determine which ideal components we need:

a)	rotational mass with inertia \(J\)

b)	rotational damper with damping constant \(b\) (to represent friction)\\
Note that a wind turbine would not have a rotational spring \(k\). If it did, the spring would get more and more extended as the rotor rotated, and eventually it would need to unwind.\\

\noindent \textbf{Step 1:} sketch the ideal element diagram
\begin{center}
	\includegraphics[width=3.1in]{figures/applicationExample/idealElementDiagram.png}
\end{center}

\noindent \textbf{Step 2:} sketch the required nodes (in this case: just one since there is only one rotational position)
\begin{center}
	\includegraphics[width=.8in]{figures/applicationExample/requiredNodes.png}
\end{center}

\noindent \textbf{Step 3:} connect the node to the ground with impedances for both the mass and damper
\begin{center}
	\includegraphics[width=2.6in]{figures/applicationExample/nodeGroundwithImpedences.png}
\end{center}

\noindent \textbf{Step 4:} add the source (torque is analogous to a current source). The current source goes into the node if a positive torque would tend to cause a positive \(\theta\).
\begin{center}
	\includegraphics[width=3.1in]{figures/applicationExample/positiveTorque.png}
\end{center}

Now that we have an impedance network, we can use circuit methods to find the transfer function. Note that the two impedances are in parallel; therefore, the total impedance is
\begin{equation*}
Z_{eq}(s) = \frac{\big(\frac{1}{Js^2}\big)\big(\frac{1}{bs}\big)}{\frac{1}{Js^2}+\frac{1}{bs}} = \frac{1}{bs+Js^2}
\end{equation*}
From the impedance version of Ohm's law, we know that \(\theta(s) = \tau(s)Z_{eq}(s)\). Therefore, our transfer function from torque to position is
\begin{equation*}
\frac{\theta(s)}{\tau(s)} = \frac{1}{Js^2+bs}
\end{equation*}
Now we have our ``plant'' (turbine) transfer function from our input signal $\tau$ to our output signal $\theta$. Later on this semester, we'll use information in this transfer function to design a proportional-integral-derivative (PID) feedback controller to achieve the desired position.



\section{Lecture Highlights}
The primary takeaways from this article include
\begin{enumerate}
	\setlength{\itemsep}{5pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
	\item Rotational mechanical systems are very similar to translational mechanical systems, with rotational inertia replacing mass, rotational dampers replacing translational dampers, rotational springs replacing translational springs, torque replacing force, and angular position replacing position. If you're struggling with a sign convention when determining a system's differential equation, you might try replacing each rotational system component with its analogous translational component to see if the signs make more sense.
\item In this class, we model fluid systems using two ideal components: tanks and linear valves.
\item The component law for a tank is a differential equation and the component law for a linear valve is an algebraic equation. You can take the Laplace transform of each equation to find the component's impedance: the transfer function from the flow to the pressure.
\item Individual impedances can be connected together according to the connection rules to form an equivalent circuit, which enables circuit-based system analysis.
\item The process for sketching the equivalent impedance circuit is to identify and sketch all nodes (including the ground), then connect nodes using component impedances and sources. 
\item As with all linear dynamic systems, system transfer functions can also be found by taking the Laplace transform of the system's differential equations, but many students find these impedance-based techniques more straightforward after some practice.
\end{enumerate}

\section{Quiz Yourself}

\subsection{Questions}


\begin{enumerate}
	\setlength{\itemsep}{5pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
%\item Find a differential equation that describes this system in terms of $p_{1}$, $p_{a}$ and $q_{in}$. The fluid density is $\rho$. 
%\begin{center}
%	\input{quizfigures/tankandvalve}
%\end{center}
\item Find an equivalent circuit using current and/or voltage sources, resistor(s), and capacitor(s) (not Laplace-domain impedance blocks) for the following system\vspace{.1in}. Note that \\
\begin{center}
	\input{quizfigures/fluidsystem1.tex}
\end{center}
\item Find an equivalent circuit using current and/or voltage sources, resistor(s), and capacitor(s) (not Laplace-domain impedance blocks) for the following fluid system. The fluid density is $\rho$. Note that there are two sources.
\begin{center}
	\input{quizfigures/fluidsystem2}
\end{center}


	\item Two tanks are connected in series, with the supply at pressure $p_{in}$, measured relative to atmospheric pressure. Use impedance network concepts to find the Laplace-domain equations that describe the behavior of the tanks, including the height of the second tank, $H_{2}(s)$.
	
	\begin{center}
		\input{quizfigures/fluidsystem.tex}
	\end{center}
	\item Find the transfer function relating $\tau$ to $\theta$ for the following system\vspace{.1in}\\
	\begin{center}
		\input{quizfigures/rotmechsystem.tex}
	\end{center}\vspace{.1in}
	
\end{enumerate}

\subsection{Solutions}
\begin{enumerate}
	\setlength{\itemsep}{5pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
% Rotating Mechanical
%\item \rule{0pt}{12pt}\\
%\begin{center}
%	\includegraphics[width=4in]{quizfigures/2soln}
%\end{center}
\item \rule{0pt}{12pt}\\
\begin{center}
	\includegraphics[width=4in]{quizfigures/1soln}
\end{center}
\item \rule{0pt}{12pt}\\
\begin{center}
	\includegraphics[width=4in]{quizfigures/3soln}
\end{center}


% Fluid Systems
	\item To find the equations, we can replace each element with the impedance equivalent, along with a ``pressure source''.  Note that there are three identifiable pressures - the pressure at the bottom of each tank, $p_{1}$ and $p_{2}$ and the atmospheric pressure $p_{a}$. Our circuit should thus have three identifiable voltage nodes (one of which will be ground)
	
	\begin{center}
		\input{figures/2tankmesh.tex}
	\end{center}
	
	The mesh equations for this system are
	\[
	\begin{bmatrix} P_{in}(s) \\ 0 \\ 0 \end{bmatrix} = \begin{bmatrix} \frac{\rho g}{sA_{1}} & -\frac{\rho g}{sA_{1}} & 0 \\
	-\frac{\rho g}{sA_{1}} & \frac{\rho g}{sA_{1}} +R_{1} + \frac{\rho g}{sA_{2}} & -\frac{\rho g}{sA_{2}} \\
	0 & -\frac{\rho g}{sA_{2}} & \frac{\rho g}{sA_{2}} +R_{2} \end{bmatrix} \begin{bmatrix} Q_{1}(s) \\ Q_{2}(s) \\ Q_{out}(s) \end{bmatrix}
	\]
	To find the relationship with $h_{2}$, we can write
	\[
	P_{2}(s) = R_{2}Q_{out}(s),
	\]
	and use the fact that
	\[
	H_{2}(s) = \frac{ P_{2}(s)}{\rho g}.
	\]
	\newpage\item \rule{0pt}{12pt}\\
	\begin{center}
		\includegraphics[width=4in]{quizfigures/4soln}
	\end{center}
	
\end{enumerate}




\section{Resources}

\subsection{Books}


\begin{itemize}
\item Fluid systems occur in the feedback control context when using hydraulic actuators and also in chemical processing. The following textbooks discuss modeling fluid systems.
\begin{itemize}
\item Gene F. Franklin, J. David Powell and Abbas Emami-Naeini,  {\em Feedback Control of Dynamic Systems}, Pearson, 6th and 7th edition: Section 2.4
\end{itemize}
\item Mechanical impedance is nothing more than using the Laplace Transform of the mechanical component laws, but this connection is not always emphasized in introductory textbooks. This is often done via the graphical modeling technique of bond graphs, which are an alternate way of drawing impedance networks. For those who are interested, the following textbook covers modeling from this point of view.
\begin{itemize}
	\item Javier A. Kypuros {\em System Dynamics and Control with Bond Graph Modeling}, CRC Press, 2013
\end{itemize}
\end{itemize}



\subsection{Web resources}
There are a variety of web resources, with differing levels of modeling for both fluid and rotating mechanical systems. In this lecture, we did not consider fluid inertia, which you may find in some on-line resources. If you find something useful, or if you find a link that no longer works, please inform your instructor!


\begin{itemize}
\item \url{http://web.mit.edu/2.151/www/Handouts/Impedances.pdf}: A handout from a system dynamics course at MIT. Note that they use velocity as the across variable, but this is just the derivative of position. 
\item A YouTube video on lumped modeling of fluid systems: \url{https://www.youtube.com/watch?v=_cpubJ94ugc}
\end{itemize}


\section{Appendix: Fluid Example with Differential Equations}

%\subsection{Example}
Although experience has shown that most students prefer to use the impedance or equivalent circuit methods to model fluid systems, for completeness we include this example: find the differential  equation that describes the relationship between $q_{in}$, and $h$ for the following system:
\begin{frame}{Tank and Valve Example}
Assume the valve is linear with valve constant $R$ and that the density of the fluid is $\rho$. The valve empties to atmospheric pressure, $p_{a}$, which is the same as the pressure at the top of the tank.
\begin{center}
	\input{figures/tankandvalve.tex}
\end{center}
\end{frame}

We use the following steps:
\begin{itemize}
\item Write down the component laws for the tank and valve, along with connection laws where applicable.
\item Write down the relationship between the pressures and the tank height.
\item Eliminate unwanted variables. 
\end{itemize}
The component laws are:
\begin{align*}
A\frac{dh}{dt} &= q_{in} - q_{out}, \\
p_{1} - p_{2} &= Rq_{out}.
\end{align*}
Note that we used a connection law to establish that the flow out of the tank is $q_{out}$, the pressure at the left side of the valve is $p_{1}$, and the pressure on the right side of the valve is $p_{a}$ where $p_a$ corresponds to $p_2$ in the component law above.  We also know that
\[
\rho g h = p_{1} - p_{2}.
\] 
Thus,
\begin{align*}
A\frac{dh}{dt} &= q_{in} - q_{out}, \\
\rho g h &= Rq_{out}.
\end{align*}
Eliminating $q_{out}$,
\[
A\frac{dh}{dt} = q_{in} - \frac{\rho g}{R} h, \\
\]
or
\[
A \frac{dh}{dt} + \frac{\rho g}{R} h = q_{in}.  \\
\]



\end{document}


