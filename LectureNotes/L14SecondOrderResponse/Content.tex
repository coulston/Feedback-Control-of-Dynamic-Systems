\mode<presentation>
{
  \usetheme{CambridgeUS}
  \usecolortheme{whale}
  \usecolortheme{lily}

  \setbeamercovered{transparent}
  \usefonttheme[onlymath]{serif}
}

\title[\SecondOrderResponseShortName] % (optional, use only with long paper titles)
{\course: \SecondOrderResponseShortName\license}

\subtitle
{Lecture \SecondOrderResponseNumber} % (optional)


\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\mode<article>{
\maketitle
\tableofcontents
}

\section{Pre-requisite Material}
This lecture assumes that the reader is familiar with the following material:
\begin{itemize}
\item Lecture \ImpedanceNumber:~\ImpedanceName
\item Lecture \SolvingDifferentialEquationsAndStabilityNumber:~\SolvingDifferentialEquationsAndStabilityName
\item Lecture \ControlAndStabilityNumber:~\ControlAndStabilityName
\end{itemize}




\section{Second Order Systems}
In order to study the step response of second order systems, it is very useful to choose a different parameterization for the transfer function. While a generic second order system without zeros would look like
\[
G(s) = \frac{c}{s^{2}+as+b},
\]
we will use the parameters $K$, $\zeta$ and $\omega_{n}$ in the following structure:
\[
G(s) = K\frac{\omega_{n}^{2}}{s^{2} +2\zeta\omega_{n}s +\omega_{n}^2}
\]
These parameters are also given names:
\begin{itemize}
\item $K$ - DC gain
\item $\zeta$ - damping ratio
\item $\omega_{n}$ - natural frequency
\end{itemize}

The pole location of the second order system can be expressed in these parameters by using the quadratic formula.
\begin{align*}
s &= -\zeta\omega_{n} \pm \sqrt{\zeta^{2}\omega_{n}^{2} - \omega_{n}^{2}} \\
& = -\zeta\omega_{n} \pm \omega_{n}\sqrt{\zeta^{2}- 1}
\end{align*}
\begin{itemize}
\item The poles are real if $\zeta \geq 1$. This is called the {\em over-damped} case.
\item The poles are complex if $0 < \zeta <1$. This is called the {\em under-damped} case. In this case
\[
s = -\zeta\omega_{n} \pm j \omega_{n}\sqrt{1-\zeta^{2}}
\]
\item The system is unstable if $\zeta \leq 0$. We will talk more about this case in later lectures. 
\end{itemize}

By mapping the poles in the complex plane, some other relationships between the pole locations and parameters can be derived
\begin{frame}{Under-damped poles in complex plane}
\begin{center}
\input{figures/underdampedpoles.tex}
\end{center}
\end{frame}
Using trigonometry we can derive the following:
\begin{itemize}
\item The distance from the origin to the poles is $\omega_{n}$
\item The angle from the negative real axis to the poles is $\beta=\cos^{-1}(\zeta)$
\item The angle from the positive imaginary axis to the poles is $\theta =\sin^{-1}(\zeta)$
\end{itemize}
\section{Second Order Step Response}

We will concentrate on the step response for a second order system in the underdamped case. The input is a step, so $R(s)=\frac{1}{s}$. The Laplace Transform of the output is
\begin{align*}
Y(s) &= G(s)R(s)\\
& = K\frac{\omega_{n}^{2}}{s^{2} +2\zeta\omega_{n}s +\omega_{n}^2}\frac{1}{s}
\end{align*}
Partial fraction expansion:
\[
Y(s) = \frac{A}{s} +\frac{Bs +C}{s^{2} +2\zeta\omega_{n} s  +\omega_{n}^{2}}
\]
Using the residue formula and equating numerators, we can find
\begin{align*}
A&=K\\
B&=-K \\
C&=-2\zeta\omega_{n}K
\end{align*}
Completing the square and re-writing terms:
\[
Y(s) = \frac{K}{s} - \frac{K(s+\zeta\omega_{n})}{(s+\zeta\omega_{n})^2 + (1-\zeta^{2})\omega_{n}^{2}}-\frac{K\zeta\omega_{n}}{(s+\zeta\omega_{n})^2 + (1-\zeta^{2})\omega_{n}^2}
\]
Let
\begin{align*}
\sigma&=\zeta\omega_{n}\\
\omega_d& = \omega_{n}\sqrt{1-\zeta^{2}}
\end{align*}
Then
\[
Y(s) = \frac{K}{s} - \frac{K(s+\sigma)}{(s+\sigma)^2 + \omega_{d}^{2}}-\frac{\frac{K\zeta}{\sqrt{1-\zeta^{2}}}\omega_{d}}{(s+\sigma)^2 + \omega_{d}^{2}}
\]
and
\[
y(t)=K-Ke^{-\sigma t}\left[\cos(\omega_{d}t) + \frac{\zeta}{\sqrt{1-\zeta^{2}}}\sin(\omega_{d} t)\right],\quad t\geq 0
\]


\section{Second Order Step Response Specifications}

The following is an example of the step response when  $\zeta=.5$. Compared to the first order case, the step response is more complicated. In particular, the response can oscillate before settling to its final value.
\begin{frame}{Second Order Step Response Specifications}
\begin{center}
\includegraphics[width=3.5in]{figures/stepreseponsespecifications}
\end{center}
\end{frame} 

The following specifications are of interest
\begin{itemize}
\item Overshoot - $M_{p}$: The amount the step response overshoots the final value. This is also expressed as the max overshoot percentage \%OS =$\frac{M_{p}}{K}\times 100 \%$.
\item Settling time - $t_s$: The time for the step response to get within 1\% of its final value and remain there.
\item Rise time - $t_r$: The time it takes for the step response to go from 10\% to 90\% of its final value.
\end{itemize}

In the remainder of the lecture, we will find how these specifications vary with $\omega$ and $\zeta$.

\subsection{Overshoot} 

In order to find the time of the peak, we can find when $\frac{dy}{dt}=0$. Instead of taking the derivative of $y(t)$ directly, however, we will use some Laplace Transform trickery. From the properties of Laplace Transform,
\[
\mathcal{L}\left\{\frac{dy}{dt}\right\} = sY(s) - y(0^{-})
\]
Then
\[
\mathcal{L}\left\{\frac{dy}{dt}\right\}  = sK \frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s +\omega_{n}^{2}}\frac{1}{s}
\]
The $s$s cancel, so
\begin{align*}
\mathcal{L}\left\{\frac{dy}{dt}\right\} & = K \frac{\omega_{n}^{2}}{s^{2}+2\zeta\omega_{n}s +\omega_{n}^{2}} \\
& = \frac{(K\frac{\omega_{n}}{\sqrt{1-\zeta^{2}}})\omega_{n}\sqrt{1-\zeta^{2}}}{(s+\sigma)^{2} + (1-\zeta^{2})\omega_{n}^2}
\end{align*}
and
\[
\frac{dy}{dt} = K\frac{\omega_{n}}{\sqrt{1-\zeta^{2}}}e^{-\sigma t}\sin(\omega_{d} t)u(t)
\]
This is equal to zero only when $\sin(\omega_{d}t)=0$, implying the peak must occur when $\omega_{d}t=0$, or $\pi$, or $2\pi$, etc. Since $\omega_{d}t=0$ corresponds to the origin, the biggest peak must be for $\omega_{d}t=\pi$, or
\[
t_{p} = \frac{\pi}{\omega_{d}}
\]
Plugging this back into our step response equation,
\[
y(t_{p})=K+M_{p} = K-Ke^{-\sigma \pi/\omega_{d}}\left[\cos(\omega_{d}\pi/\omega_{d}) + \frac{\zeta}{\sqrt{1-\zeta^{2}}}\sin(\omega_{d} \pi/\omega_{d})\right]
\]
Since $\cos(\omega_{d}\pi/\omega_{d}) =-1$ and $\sin(\omega_{d} \pi/\omega_{d})=0$, we must have
\[
K+M_{p} = K+Ke^{-\sigma \pi/\omega_{d}}
\]
or 
\[
M_{p} = Ke^{-\sigma \pi/\omega_{d}} = Ke^{-\pi\zeta/\sqrt{1-\zeta^{2}}},
\]
since $\sigma/\omega_{d} = \zeta/\sqrt{1-\zeta^{2}}$. Expressed as a percentage,
\[
\boxed{\mbox{\%OS} = \frac{M_{p}}{K} \times 100\% = \OSeq}
\]
\subsection{Settling Time}
To find the settling time, we write the step response in a more convenient form. Since $\sin(\theta) = \cos(\theta-\pi/2)$, we can write
\[
y(t)=K-Ke^{-\sigma t}\left[\cos(\omega_{d}t) + \frac{\zeta}{\sqrt{1-\zeta^{2}}}\cos(\omega_{d}t-\pi/2)\right]. 
\]
Using the phasor representation for the two sinusoids, we can combine them using a sinusoid with phasor 
\begin{align*}
X&=1+\frac{\zeta}{\sqrt{1-\zeta^{2}}}e^{j\pi/2}\\
&= 1+\frac{\zeta}{\sqrt{1-\zeta^{2}}}j\\
& = \sqrt{1+\frac{\zeta^{2}}{1-\zeta^{2}}}e^{-j\tan^{-1}\left(\zeta/\sqrt{1-\zeta^{2}}\right)}\\
& = \frac{1}{\sqrt{1-\zeta^{2}}}e^{-j\theta}
\end{align*}
where $\theta=\tan^{-1}\left(\zeta/\sqrt{1-\zeta^{2}}\right)=\sin^{-1}(\zeta)$. This means that the step response can be re-written as
\[
y(t) = K\left[1 -\frac{e^{-\sigma t}}{\sqrt{1-\zeta^{2}}}\cos(\omega_{d}t - \theta)\right]
\]
The nice thing about this representation is that we know that $-1\leq \cos(\omega_{d} t - \theta)\leq 1$. This means that $y(t)$ is always between the bounds
\[
K\left(1 - \frac{e^{-\sigma t}}{\sqrt{1-\zeta^{2}}}\right) \leq y(t) \leq K\left(1 + \frac{e^{-\sigma t}}{\sqrt{1-\zeta^{2}}}\right)
\]
The step response is guaranteed to be within 1\% of the final value (i.e. $K$) when  the exponential term is less than $.01$. This earliest time that this occurs is found by solving the following for $\ts$:
\begin{align*}
\frac{e^{-\sigma \ts}}{\sqrt{1-\zeta^{2}}}&=.01 \\
-\sigma \ts &= \ln(.01\sqrt{1-\zeta^{2}}) \\
\ts &= -\frac{\ln(.01\sqrt{1-\zeta^{2}})}{\sigma}
\end{align*}
To simplify this expression, we use the ``\course~approved'' approximation $\sqrt{1-\zeta^{2}}\approx 1$. Since $\ln(.01)=-4.6$, this results in the settling time calculation
\[
\boxed{\ts = \tseqtwo}
\]
Note that this is actually the same as in the first order case. In both cases, $-\sigma=-\zeta\omega_{n}$ is the real part of the pole. 
\subsection{Rise Time}

In order to find the rise time, our key insight is that the shape of the step response doesn't depend on $\omega_{n}$. Look at the step response for two different values of $\omega_{n}$. In both cases $\zeta=1$. 

\begin{frame}{Step Response with Varying $\omega_n$}
\begin{center}
\includegraphics[width=3in]{figures/risetime1}
\end{center}
\end{frame}

Note overshoot and number of oscillations are the same. The form of the step response explains why this is true:
\begin{frame}{Equation for step response}
\[
y(t)=K-Ke^{-\zeta(\omega_{n} t)}\left[\cos(\sqrt{1-\zeta^{2}}(\omega_{n}t)) + \frac{\zeta}{\sqrt{1-\zeta^{2}}}\sin(\sqrt{1-\zeta^{2}}(\omega_{n}t))\right]
\]
\end{frame}
Everywhere there is a $\omega_{n}$, there is a $t$. The parameter $\omega_{n}$ acts as a {\em time scaling}. If $\omega_{n}$ increases by a factor of 2, then the step response gets faster by a factor of two. In order to examine the step response, it is then useful to look at a plot in {\em normalized time} defined as $t_{n} = \omega_{n} t$. (Or we can think of this as the step response when $\omega_{n}=1$). 

\begin{frame}{Step Response in Normalized Time}
\begin{center}
\includegraphics[width=3in]{figures/risetime2}
\end{center}
\end{frame}

While the rise time does vary with $\zeta$, it does so in a restricted range. In this class, we will use the approximation that the normalized rise time is $2.2$ seconds. This implies
\[
\tr\omega_{n} = 2.2
\]
or
\[
\boxed{\tr = \treqtwo}
\]

\section{Lecture Highlights}
The primary takeaways from this article include
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item Just as in the First Order Response lecture, the impulse, step, and ramp responses refer to the time-domain behavior of the output signal when the input signal is an impulse, step, or ramp function.
\item For this class, when looking at the transient responses of second order systems we will be particularly interested in the rise time, the settling time, and the percent overshoot.
\item You should be able to compute the locations of (real or complex) second order poles by hand using the quadratic formula and plot these poles in the complex plane. The ability to visualize the locations of the poles is useful for understanding system behavior.
\item See the First Order Response lecture highlights for Matlab notes.
\end{enumerate}

\section{Quiz Yourself}

\subsection{Questions}


\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item A system is described by the transfer function
\[
\frac{Y(s)}{R(s)} = \frac{5}{s^2+4s+8}
\]
If $R(s)$ is a unit step, what is
\begin{enumerate}
\item The 10\% to 90\% rise time?
\item The time for the system to settle within 1\% of the final value?
\item The percent overshoot?
\end{enumerate}
\item Consider the following system
\begin{center}
\input{quizfigures/tankandvalve.tex}
\end{center}
%\begin{enumerate}
%\item Find the transfer function $H(s)/Q_{in}(s)$. %TF now given after F22 re-ordering of lecture articles
The transfer function from the input flow $Q_{in}(s)$ to height of fluid in the tank $H(s)$ is given by 
\[
G(s)=\frac{\frac{1}{A}}{s+\frac{\rho g}{A R}},
\]
where $A$ is the area of the tank, $\rho$ is the fluid density, $g$ is the acceleration due to gravity, and $R$ is the resistance of the valve.
%\item 
From this first-order transfer function, determine an equation or equations that involve all or some of the parameters $A, R, \rho$, and $g$ that should be satisfied for the step response settling time to be 1 second. (As always, this is the 1\% settling time.) \textit{Hint: you don't need to know anything about fluid systems to solve this problem. Just use the transfer function provided.}
%\end{enumerate}
\end{enumerate}


\subsection{Solutions}
\begin{enumerate}
\setlength{\itemsep}{5pt}
\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\item \rule{0pt}{12pt}\\
\begin{center}
\includegraphics[width=5in]{quizfigures/1soln}\\
\end{center}\pagebreak
\item \rule{0pt}{12pt}
%\begin{enumerate}
%\item \rule{0pt}{12pt}\\
%\begin{center}
%\includegraphics[width=5in]{quizfigures/2soln}\\
%\end{center}
%\item 
This is a first order system with $\sigma=\frac{\rho g}{AR}$. The settling time is given by
\[
\ts = \frac{4.6}{\sigma}
\]
Since the desired settling time is 1 second,
\begin{align*}
1 &= \frac{4.6}{\sigma}\\
\sigma & = 4.6
\end{align*}
so we need to have
\[
\frac{\rho g}{AR} = 4.6
\]
%\end{enumerate}
\end{enumerate}

\section{Resources}

\subsection{Books}


\begin{itemize}
\item Norman S. Nise, {\em Control Systems Engineering}, Wiley
\begin{itemize}
\item 7th edition: Sections 4.4-4.6
\end{itemize}
\item Richard C. Dorf and Robert H. Bishop, {\em Modern Control Systems}, Pearson
\begin{itemize}
\item 13th edition: Section 5.3
\end{itemize}
\item Gene F. Franklin, J. David Powell and Abbas Emami-Naeini,  {\em Feedback Control of Dynamic Systems}, Pearson
\begin{itemize}
\item 6th and 7th edition: Sections 3.3-3.4
\end{itemize}
\end{itemize}


\subsection{Web resources}
\begin{itemize}
\item \url{https://www.youtube.com/watch?v=uI2GCcLesaI&list=PL35E85B883E1B5976&index=24}: A 16 minute video that focuses on the {\em overdamped case} - this is a good complement to these lecture notes
\item \url{https://www.youtube.com/watch?v=LLHFn_9gYrE&index=25&list=PL35E85B883E1B5976}: A 16 minute video that focuses on the {\em underdamped case}, which is the case that is the focus of these lecture notes.
\end{itemize}


\end{document}


